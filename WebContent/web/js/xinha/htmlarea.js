HTMLArea.version={"Release":"Trunk","Head":"$HeadURL: http://svn.xinha.python-hosting.com/trunk/htmlarea.js $".replace(/^[^:]*: (.*) \$$/,"$1"),"Date":"$LastChangedDate: 2006-01-19 14:10:25 +1300 (Thu, 19 Jan 2006) $".replace(/^[^:]*: ([0-9-]*) ([0-9:]*) ([+0-9]*) \((.*)\) \$/,"$4 $2 $3"),"Revision":"$LastChangedRevision: 461 $".replace(/^[^:]*: (.*) \$$/,"$1"),"RevisionBy":"$LastChangedBy: mokhet $".replace(/^[^:]*: (.*) \$$/,"$1")};
if(typeof _editor_url=="string"){_editor_url=_editor_url.replace(/\x2f*$/,"/");}else{alert("WARNING: _editor_url is not set!  You should set this variable to the editor files path; it should preferably be an absolute path, like in '/htmlarea/', but it can be relative if you prefer.  Further we will try to load the editor files correctly but we'll probably fail.");
_editor_url="";}if(typeof _editor_lang=="string"){_editor_lang=_editor_lang.toLowerCase();}else{_editor_lang="en";}if(!(typeof _editor_skin=="string")){_editor_skin="";}var __htmlareas=[];HTMLArea.agt=navigator.userAgent.toLowerCase();HTMLArea.is_ie=((HTMLArea.agt.indexOf("msie")!=-1)&&(HTMLArea.agt.indexOf("opera")==-1));
HTMLArea.is_opera=(HTMLArea.agt.indexOf("opera")!=-1);HTMLArea.is_mac=(HTMLArea.agt.indexOf("mac")!=-1);HTMLArea.is_mac_ie=(HTMLArea.is_ie&&HTMLArea.is_mac);HTMLArea.is_win_ie=(HTMLArea.is_ie&&!HTMLArea.is_mac);HTMLArea.is_gecko=(navigator.product=="Gecko");function HTMLArea(a,c){if(!a){throw ("Tried to create HTMLArea without textarea specified.");
}if(HTMLArea.checkSupportedBrowser()){if(typeof c=="undefined"){this.config=new HTMLArea.Config();}else{this.config=c;}this._htmlArea=null;if(typeof a!="object"){a=HTMLArea.getElementById("textarea",a);}this._textArea=a;this._initial_ta_size={w:a.style.width?a.style.width:(a.offsetWidth?(a.offsetWidth+"px"):(a.cols+"em")),h:a.style.height?a.style.height:(a.offsetHeight?(a.offsetHeight+"px"):(a.rows+"em"))};
this._editMode="wysiwyg";this.plugins={};this._timerToolbar=null;this._timerUndo=null;this._undoQueue=new Array(this.config.undoSteps);this._undoPos=-1;this._customUndo=true;this._mdoc=document;this.doctype="";this.__htmlarea_id_num=__htmlareas.length;__htmlareas[this.__htmlarea_id_num]=this;this._notifyListeners={};
var b=this._panels={right:{on:true,container:document.createElement("td"),panels:[]},left:{on:true,container:document.createElement("td"),panels:[]},top:{on:true,container:document.createElement("td"),panels:[]},bottom:{on:true,container:document.createElement("td"),panels:[]}};for(var d in b){if(!b[d].container){continue;
}b[d].div=b[d].container;b[d].container.className="panels "+d;HTMLArea.freeLater(b[d],"container");HTMLArea.freeLater(b[d],"div");}HTMLArea.freeLater(this,"_textArea");}}HTMLArea.onload=function(){};HTMLArea.init=function(){HTMLArea.onload();};HTMLArea.RE_tagName=/(<\/|<)\s*([^ \t\n>]+)/ig;HTMLArea.RE_doctype=/(<!doctype((.|\n)*?)>)\n?/i;
HTMLArea.RE_head=/<head>((.|\n)*?)<\/head>/i;HTMLArea.RE_body=/<body[^>]*>((.|\n|\r|\t)*?)<\/body>/i;HTMLArea.RE_Specials=/([\/\^$*+?.()|{}[\]])/g;HTMLArea.RE_email=/[a-z0-9_]{3,}@[a-z0-9_-]{2,}(\.[a-z0-9_-]{2,})+/i;HTMLArea.RE_url=/(https?:\/\/)?(([a-z0-9_]+:[a-z0-9_]+@)?[a-z0-9_-]{2,}(\.[a-z0-9_-]{2,}){2,}(:[0-9]+)?(\/\S+)*)/i;
HTMLArea.Config=function(){var a=this;this.version=HTMLArea.version.Revision;this.width="auto";this.height="auto";this.sizeIncludesBars=true;this.sizeIncludesPanels=true;this.panel_dimensions={left:"200px",right:"200px",top:"100px",bottom:"100px"};this.statusBar=true;this.htmlareaPaste=false;this.mozParaHandler="best";
this.undoSteps=20;this.undoTimeout=500;this.fullPage=false;this.pageStyle="";this.pageStyleSheets=[];this.baseHref=null;this.stripBaseHref=true;this.stripSelfNamedAnchors=true;this.only7BitPrintablesInURLs=true;this.sevenBitClean=false;this.specialReplacements={};this.killWordOnPaste=true;this.makeLinkShowsTarget=true;
this.charSet=HTMLArea.is_gecko?document.characterSet:document.charset;this.imgURL="images/";this.popupURL="popups/";this.htmlRemoveTags=null;this.flowToolbars=true;this.toolbar=[["popupeditor"],["separator","formatblock","fontname","fontsize","bold","italic","underline","strikethrough"],["separator","forecolor","hilitecolor","textindicator"],["separator","subscript","superscript"],["linebreak","separator","justifyleft","justifycenter","justifyright","justifyfull"],["separator","insertorderedlist","insertunorderedlist","outdent","indent"],["separator","inserthorizontalrule","createlink","insertimage","inserttable"],["separator","undo","redo","selectall","print"],(HTMLArea.is_gecko?[]:["cut","copy","paste","overwrite","saveas"]),["separator","killword","clearfonts","removeformat","toggleborders","splitblock","lefttoright","righttoleft"],["separator","htmlmode","showhelp","about"]];
this.fontname={"&mdash; font &mdash;":"","Arial":"arial,helvetica,sans-serif","Courier New":"courier new,courier,monospace","Georgia":"georgia,times new roman,times,serif","Tahoma":"tahoma,arial,helvetica,sans-serif","Times New Roman":"times new roman,times,serif","Verdana":"verdana,arial,helvetica,sans-serif","impact":"impact","WingDings":"wingdings"};
this.fontsize={"&mdash; size &mdash;":"","1 (8 pt)":"1","2 (10 pt)":"2","3 (12 pt)":"3","4 (14 pt)":"4","5 (18 pt)":"5","6 (24 pt)":"6","7 (36 pt)":"7"};this.formatblock={"&mdash; format &mdash;":"","Heading 1":"h1","Heading 2":"h2","Heading 3":"h3","Heading 4":"h4","Heading 5":"h5","Heading 6":"h6","Normal":"p","Address":"address","Formatted":"pre"};
this.customSelects={};function b(h,f,g){h.execCommand(f);}this.debug=true;this.URIs={"blank":"popups/blank.html","link":"link.html","insert_image":"insert_image.html","insert_table":"insert_table.html","select_color":"select_color.html","about":"about.html","help":"editor_help.html"};this.btnList={bold:["Bold",HTMLArea._lc({key:"button_bold",string:["ed_buttons_main.gif",3,2]},"HTMLArea"),false,function(f){f.execCommand("bold");
}],italic:["Italic",HTMLArea._lc({key:"button_italic",string:["ed_buttons_main.gif",2,2]},"HTMLArea"),false,function(f){f.execCommand("italic");}],underline:["Underline",HTMLArea._lc({key:"button_underline",string:["ed_buttons_main.gif",2,0]},"HTMLArea"),false,function(f){f.execCommand("underline");}],strikethrough:["Strikethrough",HTMLArea._lc({key:"button_strikethrough",string:["ed_buttons_main.gif",3,0]},"HTMLArea"),false,function(f){f.execCommand("strikethrough");
}],subscript:["Subscript",HTMLArea._lc({key:"button_subscript",string:["ed_buttons_main.gif",3,1]},"HTMLArea"),false,function(f){f.execCommand("subscript");}],superscript:["Superscript",HTMLArea._lc({key:"button_superscript",string:["ed_buttons_main.gif",2,1]},"HTMLArea"),false,function(f){f.execCommand("superscript");
}],justifyleft:["Justify Left",["ed_buttons_main.gif",0,0],false,function(f){f.execCommand("justifyleft");}],justifycenter:["Justify Center",["ed_buttons_main.gif",1,1],false,function(f){f.execCommand("justifycenter");}],justifyright:["Justify Right",["ed_buttons_main.gif",1,0],false,function(f){f.execCommand("justifyright");
}],justifyfull:["Justify Full",["ed_buttons_main.gif",0,1],false,function(f){f.execCommand("justifyfull");}],orderedlist:["Ordered List",["ed_buttons_main.gif",0,3],false,function(f){f.execCommand("insertorderedlist");}],unorderedlist:["Bulleted List",["ed_buttons_main.gif",1,3],false,function(f){f.execCommand("insertunorderedlist");
}],insertorderedlist:["Ordered List",["ed_buttons_main.gif",0,3],false,function(f){f.execCommand("insertorderedlist");}],insertunorderedlist:["Bulleted List",["ed_buttons_main.gif",1,3],false,function(f){f.execCommand("insertunorderedlist");}],outdent:["Decrease Indent",["ed_buttons_main.gif",1,2],false,function(f){f.execCommand("outdent");
}],indent:["Increase Indent",["ed_buttons_main.gif",0,2],false,function(f){f.execCommand("indent");}],forecolor:["Font Color",["ed_buttons_main.gif",3,3],false,function(f){f.execCommand("forecolor");}],hilitecolor:["Background Color",["ed_buttons_main.gif",2,3],false,function(f){f.execCommand("hilitecolor");
}],undo:["Undoes your last action",["ed_buttons_main.gif",4,2],false,function(f){f.execCommand("undo");}],redo:["Redoes your last action",["ed_buttons_main.gif",5,2],false,function(f){f.execCommand("redo");}],cut:["Cut selection",["ed_buttons_main.gif",5,0],false,b],copy:["Copy selection",["ed_buttons_main.gif",4,0],false,b],paste:["Paste from clipboard",["ed_buttons_main.gif",4,1],false,b],selectall:["Select all","ed_selectall.gif",false,function(f){f.execCommand("selectall");
}],inserthorizontalrule:["Horizontal Rule",["ed_buttons_main.gif",6,0],false,function(f){f.execCommand("inserthorizontalrule");}],createlink:["Insert Web Link",["ed_buttons_main.gif",6,1],false,function(f){f._createLink();}],insertimage:["Insert/Modify Image",["ed_buttons_main.gif",6,3],false,function(f){f.execCommand("insertimage");
}],inserttable:["Insert Table",["ed_buttons_main.gif",6,2],false,function(f){f.execCommand("inserttable");}],htmlmode:["Toggle HTML Source",["ed_buttons_main.gif",7,0],true,function(f){f.execCommand("htmlmode");}],toggleborders:["Toggle Borders",["ed_buttons_main.gif",7,2],false,function(f){f._toggleBorders();
}],print:["Print document",["ed_buttons_main.gif",8,1],false,function(f){if(HTMLArea.is_gecko){f._iframe.contentWindow.print();}else{f.focusEditor();print();}}],saveas:["Save as","ed_saveas.gif",false,function(f){f.execCommand("saveas",false,"noname.htm");}],about:["About this editor",["ed_buttons_main.gif",8,2],true,function(f){f.execCommand("about");
}],showhelp:["Help using editor",["ed_buttons_main.gif",9,2],true,function(f){f.execCommand("showhelp");}],splitblock:["Split Block","ed_splitblock.gif",false,function(f){f._splitBlock();}],lefttoright:["Direction left to right",["ed_buttons_main.gif",0,4],false,function(f){f.execCommand("lefttoright");
}],righttoleft:["Direction right to left",["ed_buttons_main.gif",1,4],false,function(f){f.execCommand("righttoleft");}],overwrite:["Insert/Overwrite","ed_overwrite.gif",false,function(f){f.execCommand("overwrite");}],wordclean:["MS Word Cleaner",["ed_buttons_main.gif",5,3],false,function(f){f._wordClean();
}],clearfonts:["Clear Inline Font Specifications",["ed_buttons_main.gif",5,4],true,function(f){f._clearFonts();}],removeformat:["Remove formatting",["ed_buttons_main.gif",4,4],false,function(f){f.execCommand("removeformat");}],killword:["Clear MSOffice tags",["ed_buttons_main.gif",4,3],false,function(f){f.execCommand("killword");
}]};for(var d in this.btnList){var c=this.btnList[d];if(typeof c!="object"){continue;}if(typeof c[1]!="string"){c[1][0]=_editor_url+this.imgURL+c[1][0];}else{c[1]=_editor_url+this.imgURL+c[1];}c[0]=HTMLArea._lc(c[0]);}};HTMLArea.Config.prototype.registerButton=function(g,e,f,a,d,c){var b;if(typeof g=="string"){b=g;
}else{if(typeof g=="object"){b=g.id;}else{alert("ERROR [HTMLArea.Config::registerButton]:\ninvalid arguments");return false;}}if(typeof this.customSelects[b]!="undefined"){}if(typeof this.btnList[b]!="undefined"){}switch(typeof g){case"string":this.btnList[g]=[e,f,a,d,c];break;case"object":this.btnList[g.id]=[g.tooltip,g.image,g.textMode,g.action,g.context];
break;}};HTMLArea.prototype.registerPanel=function(c,b){if(!c){c="right";}var a=this.addPanel(c);if(b){b.drawPanelIn(a);}};HTMLArea.Config.prototype.registerDropdown=function(a){if(typeof this.customSelects[a.id]!="undefined"){}if(typeof this.btnList[a.id]!="undefined"){}this.customSelects[a.id]=a;};
HTMLArea.Config.prototype.hideSomeButtons=function(b){var f=this.toolbar;for(var e=f.length;--e>=0;){var c=f[e];for(var d=c.length;--d>=0;){if(b.indexOf(" "+c[d]+" ")>=0){var a=1;if(/separator|space/.test(c[d+1])){a=2;}c.splice(d,a);}}}};HTMLArea.Config.prototype.addToolbarElement=function(d,h,k){var p=this.toolbar;
var q,g,f,e,c;var n=false;var b=false;var t=0;var l=0;var m=0;var r=false;var s=false;if((d&&typeof d=="object")&&(d.constructor==Array)){n=true;}if((h&&typeof h=="object")&&(h.constructor==Array)){b=true;t=h.length;}if(n){for(g=0;g<d.length;++g){if((d[g]!="separator")&&(d[g].indexOf("T[")!=0)){c=d[g];
}}}else{c=d;}for(var g=0;!r&&!s&&g<p.length;++g){q=p[g];for(f=0;!s&&f<q.length;++f){if(q[g]==c){r=true;break;}if(b){for(e=0;e<t;++e){if(q[f]==h[e]){if(e==0){s=true;f--;break;}else{m=g;l=f;t=e;}}}}else{if(q[f]==h){s=true;break;}}}}if(!r){if(!s&&b){if(h.length!=t){f=l;q=p[m];s=true;}}if(s){if(k==0){if(n){q[f]=d[d.length-1];
for(g=d.length-1;--g>=0;){q.splice(f,0,d[g]);}}else{q[f]=d;}}else{if(k<0){f=f+k+1;}else{if(k>0){f=f+k;}}if(n){for(g=d.length;--g>=0;){q.splice(f,0,d[g]);}}else{q.splice(f,0,d);}}}else{p[0].splice(0,0,"separator");if(n){for(g=d.length;--g>=0;){p[0].splice(0,0,d[g]);}}else{p[0].splice(0,0,d);}}}};HTMLArea.replaceAll=function(a){var c=document.getElementsByTagName("textarea");
for(var b=c.length;b>0;(new HTMLArea(c[--b],a)).generate()){}};HTMLArea.replace=function(c,b){var a=HTMLArea.getElementById("textarea",c);return a?(new HTMLArea(a,b)).generate():null;};HTMLArea.prototype._createToolbar=function(){var b=this;var c=document.createElement("div");this._toolBar=this._toolbar=c;
c.className="toolbar";c.unselectable="1";HTMLArea.freeLater(this,"_toolBar");HTMLArea.freeLater(this,"_toolbar");var a=null;var d=new Object();this._toolbarObjects=d;this._createToolbar1(b,c,d);this._htmlArea.appendChild(c);return c;};HTMLArea.prototype._setConfig=function(a){this.config=a;};HTMLArea.prototype._addToolbar=function(){this._createToolbar1(this,this._toolbar,this._toolbarObjects);
};HTMLArea.prototype._createToolbar1=function(editor,toolbar,tb_objects){if(editor.config.flowToolbars){var brk=document.createElement("div");brk.style.height=brk.style.width=brk.style.lineHeight=brk.style.fontSize="1px";brk.style.clear="both";toolbar.appendChild(brk);}function newLine(){if(typeof tb_row!="undefined"&&tb_row.childNodes.length==0){return;
}var table=document.createElement("table");table.border="0px";table.cellSpacing="0px";table.cellPadding="0px";if(editor.config.flowToolbars){if(HTMLArea.is_ie){table.style.styleFloat="left";}else{table.style.cssFloat="left";}}toolbar.appendChild(table);var tb_body=document.createElement("tbody");table.appendChild(tb_body);
tb_row=document.createElement("tr");tb_body.appendChild(tb_row);table.className="toolbarRow";}newLine();function setButtonStatus(id,newval){var oldval=this[id];var el=this.element;if(oldval!=newval){switch(id){case"enabled":if(newval){HTMLArea._removeClass(el,"buttonDisabled");el.disabled=false;}else{HTMLArea._addClass(el,"buttonDisabled");
el.disabled=true;}break;case"active":if(newval){HTMLArea._addClass(el,"buttonPressed");}else{HTMLArea._removeClass(el,"buttonPressed");}break;}this[id]=newval;}}function createSelect(txt){var options=null;var el=null;var cmd=null;var customSelects=editor.config.customSelects;var context=null;var tooltip="";
switch(txt){case"fontsize":case"fontname":case"formatblock":options=editor.config[txt];cmd=txt;break;default:cmd=txt;var dropdown=customSelects[cmd];if(typeof dropdown!="undefined"){options=dropdown.options;context=dropdown.context;if(typeof dropdown.tooltip!="undefined"){tooltip=dropdown.tooltip;}}else{alert("ERROR [createSelect]:\nCan't find the requested dropdown definition");
}break;}if(options){el=document.createElement("select");el.title=tooltip;var obj={name:txt,element:el,enabled:true,text:false,cmd:cmd,state:setButtonStatus,context:context};HTMLArea.freeLater(obj);tb_objects[txt]=obj;for(var i in options){if(typeof(options[i])!="string"){continue;}var op=document.createElement("option");
op.innerHTML=HTMLArea._lc(i);op.value=options[i];el.appendChild(op);}HTMLArea._addEvent(el,"change",function(){editor._comboSelected(el,txt);});}return el;}function createButton(txt){var el=null;var btn=null;switch(txt){case"separator":if(editor.config.flowToolbars){newLine();}el=document.createElement("div");
el.className="separator";break;case"space":el=document.createElement("div");el.className="space";break;case"linebreak":newLine();return false;case"textindicator":el=document.createElement("div");el.appendChild(document.createTextNode("A"));el.className="indicator";el.title=HTMLArea._lc("Current style");
var obj={name:txt,element:el,enabled:true,active:false,text:false,cmd:"textindicator",state:setButtonStatus};HTMLArea.freeLater(obj);tb_objects[txt]=obj;break;default:btn=editor.config.btnList[txt];}if(!el&&btn){el=document.createElement("a");el.style.display="block";el.href="javascript:void(0)";el.style.textDecoration="none";
el.title=btn[0];el.className="button";var obj={name:txt,element:el,enabled:true,active:false,text:btn[2],cmd:btn[3],state:setButtonStatus,context:btn[4]||null};HTMLArea.freeLater(obj);tb_objects[txt]=obj;HTMLArea._addEvent(el,"mouseout",function(){if(obj.enabled){with(HTMLArea){_removeClass(el,"buttonActive");
(obj.active)&&_addClass(el,"buttonPressed");}}});HTMLArea._addEvent(el,"mousedown",function(ev){if(obj.enabled){with(HTMLArea){_addClass(el,"buttonActive");_removeClass(el,"buttonPressed");_stopEvent(is_ie?window.event:ev);}}});HTMLArea._addEvent(el,"click",function(ev){if(obj.enabled){with(HTMLArea){_removeClass(el,"buttonActive");
if(HTMLArea.is_gecko){editor.activateEditor();}obj.cmd(editor,obj.name,obj);_stopEvent(is_ie?window.event:ev);}}});var i_contain=HTMLArea.makeBtnImg(btn[1]);var img=i_contain.firstChild;el.appendChild(i_contain);obj.imgel=img;obj.swapImage=function(newimg){if(typeof newimg!="string"){img.src=newimg[0];
img.style.position="relative";img.style.top=newimg[2]?("-"+(18*(newimg[2]+1))+"px"):"-18px";img.style.left=newimg[1]?("-"+(18*(newimg[1]+1))+"px"):"-18px";}else{obj.imgel.src=newimg;img.style.top="0px";img.style.left="0px";}};}else{if(!el){el=createSelect(txt);}}return el;}var first=true;for(var i=0;
i<this.config.toolbar.length;++i){if(!first){}else{first=false;}if(this.config.toolbar[i]==null){this.config.toolbar[i]=["separator"];}var group=this.config.toolbar[i];for(var j=0;j<group.length;++j){var code=group[j];if(/^([IT])\[(.*?)\]/.test(code)){var l7ed=RegExp.$1=="I";var label=RegExp.$2;if(l7ed){label=HTMLArea._lc(label);
}var tb_cell=document.createElement("td");tb_row.appendChild(tb_cell);tb_cell.className="label";tb_cell.innerHTML=label;}else{if(typeof code!="function"){var tb_element=createButton(code);if(tb_element){var tb_cell=document.createElement("td");tb_cell.className="toolbarElement";tb_row.appendChild(tb_cell);
tb_cell.appendChild(tb_element);}else{if(tb_element==null){alert("FIXME: Unknown toolbar item: "+code);}}}}}}if(editor.config.flowToolbars){var brk=document.createElement("div");brk.style.height=brk.style.width=brk.style.lineHeight=brk.style.fontSize="1px";brk.style.clear="both";toolbar.appendChild(brk);
}return toolbar;};use_clone_img=false;HTMLArea.makeBtnImg=function(b,c){if(!c){c=document;}if(!c._htmlareaImgCache){c._htmlareaImgCache={};HTMLArea.freeLater(c._htmlareaImgCache);}var d=null;if(HTMLArea.is_ie&&((!c.compatMode)||(c.compatMode&&c.compatMode=="BackCompat"))){d=c.createElement("span");}else{d=c.createElement("div");
d.style.position="relative";}d.style.overflow="hidden";d.style.width="18px";d.style.height="18px";d.className="buttonImageContainer";var a=null;if(typeof b=="string"){if(c._htmlareaImgCache[b]){a=c._htmlareaImgCache[b].cloneNode();}else{a=c.createElement("img");a.src=b;a.style.width="18px";a.style.height="18px";
if(use_clone_img){c._htmlareaImgCache[b]=a.cloneNode();}}}else{if(c._htmlareaImgCache[b[0]]){a=c._htmlareaImgCache[b[0]].cloneNode();}else{a=c.createElement("img");a.src=b[0];a.style.position="relative";if(use_clone_img){c._htmlareaImgCache[b[0]]=a.cloneNode();}}a.style.top=b[2]?("-"+(18*(b[2]+1))+"px"):"-18px";
a.style.left=b[1]?("-"+(18*(b[1]+1))+"px"):"-18px";}d.appendChild(a);return d;};HTMLArea.prototype._createStatusBar=function(){var a=document.createElement("div");a.className="statusBar";this._statusBar=a;HTMLArea.freeLater(this,"_statusBar");div=document.createElement("span");div.className="statusBarTree";
div.innerHTML=HTMLArea._lc("Path")+": ";this._statusBarTree=div;HTMLArea.freeLater(this,"_statusBarTree");this._statusBar.appendChild(div);div=document.createElement("span");div.innerHTML=HTMLArea._lc("You are in TEXT MODE.  Use the [<>] button to switch back to WYSIWYG.");div.style.display="none";this._statusBarTextMode=div;
HTMLArea.freeLater(this,"_statusBarTextMode");this._statusBar.appendChild(div);if(!this.config.statusBar){a.style.display="none";}return a;};HTMLArea.prototype.generate=function(){var g=this;if(typeof Dialog=="undefined"){HTMLArea._loadback(_editor_url+"dialog.js",function(){g.generate();});return false;
}if(typeof HTMLArea.Dialog=="undefined"){HTMLArea._loadback(_editor_url+"inline-dialog.js",function(){g.generate();});return false;}if(typeof PopupWin=="undefined"){HTMLArea._loadback(_editor_url+"popupwin.js",function(){g.generate();});return false;}if(_editor_skin!=""){var p=false;var l=document.getElementsByTagName("head")[0];
var o=document.getElementsByTagName("link");for(var f=0;f<o.length;f++){if((o[f].rel=="stylesheet")&&(o[f].href==_editor_url+"skins/"+_editor_skin+"/skin.css")){p=true;}}if(!p){var k=document.createElement("link");k.type="text/css";k.href=_editor_url+"skins/"+_editor_skin+"/skin.css";k.rel="stylesheet";
l.appendChild(k);}}var m=g.config.toolbar;for(var f=m.length;--f>=0;){for(var d=m[f].length;--d>=0;){if(m[f][d]=="popupeditor"){if(typeof FullScreen=="undefined"){HTMLArea.loadPlugin("FullScreen",function(){g.generate();});return false;}g.registerPlugin("FullScreen");}}}if(HTMLArea.is_gecko){switch(g.config.mozParaHandler){case"best":if(typeof EnterParagraphs=="undefined"){HTMLArea.loadPlugin("EnterParagraphs",function(){g.generate();
});return false;}g.registerPlugin("EnterParagraphs");break;case"dirty":case"built-in":default:break;}}this._framework={"table":document.createElement("table"),"tbody":document.createElement("tbody"),"tb_row":document.createElement("tr"),"tb_cell":document.createElement("td"),"tp_row":document.createElement("tr"),"tp_cell":this._panels.top.container,"ler_row":document.createElement("tr"),"lp_cell":this._panels.left.container,"ed_cell":document.createElement("td"),"rp_cell":this._panels.right.container,"bp_row":document.createElement("tr"),"bp_cell":this._panels.bottom.container,"sb_row":document.createElement("tr"),"sb_cell":document.createElement("td")};
HTMLArea.freeLater(this._framework);var b=this._framework;b.table.border="0";b.table.cellPadding="0";b.table.cellSpacing="0";b.tb_row.style.verticalAlign="top";b.tp_row.style.verticalAlign="top";b.ler_row.style.verticalAlign="top";b.bp_row.style.verticalAlign="top";b.sb_row.style.verticalAlign="top";
b.ed_cell.style.position="relative";b.tb_row.appendChild(b.tb_cell);b.tb_cell.colSpan=3;b.tp_row.appendChild(b.tp_cell);b.tp_cell.colSpan=3;b.ler_row.appendChild(b.lp_cell);b.ler_row.appendChild(b.ed_cell);b.ler_row.appendChild(b.rp_cell);b.bp_row.appendChild(b.bp_cell);b.bp_cell.colSpan=3;b.sb_row.appendChild(b.sb_cell);
b.sb_cell.colSpan=3;b.tbody.appendChild(b.tb_row);b.tbody.appendChild(b.tp_row);b.tbody.appendChild(b.ler_row);b.tbody.appendChild(b.bp_row);b.tbody.appendChild(b.sb_row);b.table.appendChild(b.tbody);var a=this._framework.table;this._htmlArea=a;HTMLArea.freeLater(this,"_htmlArea");a.className="htmlarea";
var m=this._createToolbar();this._framework.tb_cell.appendChild(m);var c=document.createElement("iframe");c.src=_editor_url+g.config.URIs["blank"];this._framework.ed_cell.appendChild(c);this._iframe=c;this._iframe.className="xinha_iframe";HTMLArea.freeLater(this,"_iframe");var h=this._createStatusBar();
this._framework.sb_cell.appendChild(h);var n=this._textArea;n.parentNode.insertBefore(a,n);n.className="xinha_textarea";HTMLArea.removeFromParent(n);this._framework.ed_cell.appendChild(n);if(n.form){HTMLArea.prependDom0Event(this._textArea.form,"submit",function(){g._textArea.value=g.outwardHtml(g.getHTML());
return true;});var e=n.value;HTMLArea.prependDom0Event(this._textArea.form,"reset",function(){g.setHTML(g.inwardHtml(e));g.updateToolbar();return true;});}HTMLArea.prependDom0Event(window,"unload",function(){n.value=g.outwardHtml(g.getHTML());return true;});n.style.display="none";g.initSize();g._iframeLoadDone=false;
HTMLArea._addEvent(this._iframe,"load",function(i){if(!g._iframeLoadDone){g._iframeLoadDone=true;g.initIframe();}return true;});};HTMLArea.prototype.initSize=function(){var c=this;var b=null;var a=null;switch(this.config.width){case"auto":b=this._initial_ta_size.w;break;case"toolbar":b=this._toolBar.offsetWidth+"px";
break;default:b=/[^0-9]/.test(this.config.width)?this.config.width:this.config.width+"px";break;}switch(this.config.height){case"auto":a=this._initial_ta_size.h;break;default:a=/[^0-9]/.test(this.config.height)?this.config.height:this.config.height+"px";break;}this.sizeEditor(b,a,this.config.sizeIncludesBars,this.config.sizeIncludesPanels);
HTMLArea.addDom0Event(window,"resize",function(d){c.sizeEditor();});this.notifyOn("panel_change",function(){c.sizeEditor();});};HTMLArea.prototype.sizeEditor=function(e,k,b,d){this._iframe.style.height="100%";this._textArea.style.height="100%";this._iframe.style.width="";this._textArea.style.width="";
if(b!=null){this._htmlArea.sizeIncludesToolbars=b;}if(d!=null){this._htmlArea.sizeIncludesPanels=d;}if(e!=null){this._htmlArea.style.width=e;if(!this._htmlArea.sizeIncludesPanels){var a=this._panels.right;if(a.on&&a.panels.length&&HTMLArea.hasDisplayedChildren(a.div)){this._htmlArea.style.width=this._htmlArea.offsetWidth+parseInt(this.config.panel_dimensions.right);
}var a=this._panels.left;if(a.on&&a.panels.length&&HTMLArea.hasDisplayedChildren(a.div)){this._htmlArea.style.width=this._htmlArea.offsetWidth+parseInt(this.config.panel_dimensions.left);}}}if(k!=null){this._htmlArea.style.height=k;if(!this._htmlArea.sizeIncludesToolbars){this._htmlArea.style.height=this._htmlArea.offsetHeight+this._toolbar.offsetHeight+this._statusBar.offsetHeight;
}if(!this._htmlArea.sizeIncludesPanels){var a=this._panels.top;if(a.on&&a.panels.length&&HTMLArea.hasDisplayedChildren(a.div)){this._htmlArea.style.height=this._htmlArea.offsetHeight+parseInt(this.config.panel_dimensions.top);}var a=this._panels.bottom;if(a.on&&a.panels.length&&HTMLArea.hasDisplayedChildren(a.div)){this._htmlArea.style.height=this._htmlArea.offsetHeight+parseInt(this.config.panel_dimensions.bottom);
}}}e=this._htmlArea.offsetWidth;k=this._htmlArea.offsetHeight;var i=this._panels;var h=this;var c=1;function g(l){if(i[l].on&&i[l].panels.length&&HTMLArea.hasDisplayedChildren(i[l].container)){i[l].container.style.display="";return true;}else{i[l].container.style.display="none";return false;}}if(g("left")){c+=1;
}if(g("top")){}if(g("right")){c+=1;}if(g("bottom")){}this._framework.tb_cell.colSpan=c;this._framework.tp_cell.colSpan=c;this._framework.bp_cell.colSpan=c;this._framework.sb_cell.colSpan=c;if(!this._framework.tp_row.childNodes.length){HTMLArea.removeFromParent(this._framework.tp_row);}else{if(!HTMLArea.hasParentNode(this._framework.tp_row)){this._framework.tbody.insertBefore(this._framework.tp_row,this._framework.ler_row);
}}if(!this._framework.bp_row.childNodes.length){HTMLArea.removeFromParent(this._framework.bp_row);}else{if(!HTMLArea.hasParentNode(this._framework.bp_row)){this._framework.tbody.insertBefore(this._framework.bp_row,this._framework.ler_row.nextSibling);}}if(!this.config.statusBar){HTMLArea.removeFromParent(this._framework.sb_row);
}else{if(!HTMLArea.hasParentNode(this._framework.sb_row)){this._framework.table.appendChild(this._framework.sb_row);}}this._framework.lp_cell.style.width=this.config.panel_dimensions.left;this._framework.rp_cell.style.width=this.config.panel_dimensions.right;this._framework.tp_cell.style.height=this.config.panel_dimensions.top;
this._framework.bp_cell.style.height=this.config.panel_dimensions.bottom;this._framework.tb_cell.style.height=this._toolBar.offsetHeight+"px";this._framework.sb_cell.style.height=this._statusBar.offsetHeight+"px";var j=k-this._toolBar.offsetHeight-this._statusBar.offsetHeight;if(g("top")){j-=parseInt(this.config.panel_dimensions.top);
}if(g("bottom")){j-=parseInt(this.config.panel_dimensions.bottom);}this._iframe.style.height=j+"px";var f=e;if(g("left")){f-=parseInt(this.config.panel_dimensions.left);}if(g("right")){f-=parseInt(this.config.panel_dimensions.right);}this._iframe.style.width=f+"px";this._textArea.style.height=this._iframe.style.height;
this._textArea.style.width=this._iframe.style.width;this.notifyOf("resize",{width:this._htmlArea.offsetWidth,height:this._htmlArea.offsetHeight});};HTMLArea.prototype.addPanel=function(a){var b=document.createElement("div");b.side=a;if(a=="left"||a=="right"){b.style.width=this.config.panel_dimensions[a];
}HTMLArea.addClasses(b,"panel");this._panels[a].panels.push(b);this._panels[a].div.appendChild(b);this.notifyOf("panel_change",{"action":"add","panel":b});return b;};HTMLArea.prototype.removePanel=function(a){this._panels[a.side].div.removeChild(a);var c=[];for(var b=0;b<this._panels[a.side].panels.length;
b++){if(this._panels[a.side].panels[b]!=a){c.push(this._panels[a.side].panels[b]);}}this._panels[a.side].panels=c;this.notifyOf("panel_change",{"action":"remove","panel":a});};HTMLArea.prototype.hidePanel=function(a){if(a){a.style.display="none";this.notifyOf("panel_change",{"action":"hide","panel":a});
}};HTMLArea.prototype.showPanel=function(a){if(a){a.style.display="";this.notifyOf("panel_change",{"action":"show","panel":a});}};HTMLArea.prototype.hidePanels=function(b){if(typeof b=="undefined"){b=["left","right","top","bottom"];}var c=[];for(var a=0;a<b.length;a++){if(this._panels[b[a]].on){c.push(b[a]);
this._panels[b[a]].on=false;}}this.notifyOf("panel_change",{"action":"multi_hide","sides":b});};HTMLArea.prototype.showPanels=function(c){if(typeof c=="undefined"){c=["left","right","top","bottom"];}var a=[];for(var b=0;b<c.length;b++){if(!this._panels[c[b]].on){a.push(c[b]);this._panels[c[b]].on=true;
}}this.notifyOf("panel_change",{"action":"multi_show","sides":c});};HTMLArea.objectProperties=function(c){var b=[];for(var a in c){b[b.length]=a;}return b;};HTMLArea.prototype.editorIsActivated=function(){try{if(HTMLArea.is_gecko){return(this._doc.designMode=="on");}else{return(this._doc.body.contentEditable);
}}catch(a){return false;}};HTMLArea._someEditorHasBeenActivated=false;HTMLArea._currentlyActiveEditor=false;HTMLArea.prototype.activateEditor=function(){if(HTMLArea._currentlyActiveEditor){if(HTMLArea._currentlyActiveEditor==this){return true;}HTMLArea._currentlyActiveEditor.deactivateEditor();}if(HTMLArea.is_gecko&&this._doc.designMode!="on"){try{if(this._iframe.style.display=="none"){this._iframe.style.display="";
this._doc.designMode="on";this._iframe.style.display="none";}else{this._doc.designMode="on";}}catch(b){}}else{if(!HTMLArea.is_gecko&&this._doc.body.contentEditable!=true){this._doc.body.contentEditable=true;}}HTMLArea._someEditorHasBeenActivated=true;HTMLArea._currentlyActiveEditor=this;var a=this;this.enableToolbar();
};HTMLArea.prototype.deactivateEditor=function(){this.disableToolbar();if(HTMLArea.is_gecko&&this._doc.designMode!="off"){try{this._doc.designMode="off";}catch(a){}}else{if(!HTMLArea.is_gecko&&this._doc.body.contentEditable!=false){this._doc.body.contentEditable=false;}}if(HTMLArea._currentlyActiveEditor!=this){return;
}HTMLArea._currentlyActiveEditor=false;};HTMLArea.prototype.initIframe=function(){this.disableToolbar();var d=null;var b=this;try{if(b._iframe.contentDocument){this._doc=b._iframe.contentDocument;}else{this._doc=b._iframe.contentWindow.document;}d=this._doc;if(!d){if(HTMLArea.is_gecko){setTimeout(function(){b.initIframe();
},50);return false;}else{alert("ERROR: IFRAME can't be initialized.");}}}catch(c){setTimeout(function(){b.initIframe();},50);}HTMLArea.freeLater(this,"_doc");d.open();if(!b.config.fullPage){var a="<html>\n";a+="<head>\n";a+='<meta http-equiv="Content-Type" content="text/html; charset='+b.config.charSet+'">\n';
if(typeof b.config.baseHref!="undefined"&&b.config.baseHref!=null){a+='<base href="'+b.config.baseHref+'"/>\n';}a+='<style title="table borders">'+".htmtableborders, .htmtableborders td, .htmtableborders th {border : 1px dashed lightgrey ! important;} \n"+"</style>\n";a+='<style type="text/css">'+"html, body { border: 0px;  background-color: #ffffff; } \n"+"span.macro, span.macro ul, span.macro div, span.macro p {background : #CCCCCC;}\n"+"</style>\n";
if(b.config.pageStyle){a+='<style type="text/css">\n'+b.config.pageStyle+"\n</style>";}if(typeof b.config.pageStyleSheets!=="undefined"){for(style_i=0;style_i<b.config.pageStyleSheets.length;style_i++){if(b.config.pageStyleSheets[style_i].length>0){a+='<link rel="stylesheet" type="text/css" href="'+b.config.pageStyleSheets[style_i]+'">';
}}}a+="</head>\n";a+="<body>\n";a+=b.inwardHtml(b._textArea.value);a+="</body>\n";a+="</html>";}else{var a=b.inwardHtml(b._textArea.value);if(a.match(HTMLArea.RE_doctype)){b.setDoctype(RegExp.$1);a=a.replace(HTMLArea.RE_doctype,"");}}d.write(a);d.close();this.setEditorEvents();};HTMLArea.prototype.whenDocReady=function(b){var a=this;
if(!this._doc.body){setTimeout(function(){a.whenDocReady(b);},50);}else{b();}};HTMLArea.prototype.setMode=function(d){if(typeof d=="undefined"){d=((this._editMode=="textmode")?"wysiwyg":"textmode");}switch(d){case"textmode":var b=this.outwardHtml(this.getHTML());this.setHTML(b);this.deactivateEditor();
this._iframe.style.display="none";this._textArea.style.display="";if(this.config.statusBar){this._statusBarTree.style.display="none";this._statusBarTextMode.style.display="";}this.notifyOf("modechange",{"mode":"text"});break;case"wysiwyg":var b=this.inwardHtml(this.getHTML());this.deactivateEditor();
this.setHTML(b);this._iframe.style.display="";this._textArea.style.display="none";this.activateEditor();if(this.config.statusBar){this._statusBarTree.style.display="";this._statusBarTextMode.style.display="none";}this.notifyOf("modechange",{"mode":"wysiwyg"});break;default:alert("Mode <"+d+"> not defined!");
return false;}this._editMode=d;for(var a in this.plugins){var c=this.plugins[a].instance;if(c&&typeof c.onMode=="function"){c.onMode(d);}}};HTMLArea.prototype.setFullHTML=function(c){var a=RegExp.multiline;RegExp.multiline=true;if(c.match(HTMLArea.RE_doctype)){this.setDoctype(RegExp.$1);c=c.replace(HTMLArea.RE_doctype,"");
}RegExp.multiline=a;if(!HTMLArea.is_ie){if(c.match(HTMLArea.RE_head)){this._doc.getElementsByTagName("head")[0].innerHTML=RegExp.$1;}if(c.match(HTMLArea.RE_body)){this._doc.getElementsByTagName("body")[0].innerHTML=RegExp.$1;}}else{var d=this.editorIsActivated();if(d){this.deactivateEditor();}var b=/<html>((.|\n)*?)<\/html>/i;
c=c.replace(b,"$1");this._doc.open();this._doc.write(c);this._doc.close();if(d){this.activateEditor();}this.setEditorEvents();return true;}};HTMLArea.prototype.setEditorEvents=function(){var a=this;var b=this._doc;a.whenDocReady(function(){HTMLArea._addEvents(b,["mousedown"],function(){a.activateEditor();
return true;});HTMLArea._addEvents(b,["keydown","keypress","mousedown","mouseup","drag"],function(e){return a._editorEvent(HTMLArea.is_ie?a._iframe.contentWindow.event:e);});for(var c in a.plugins){var d=a.plugins[c].instance;HTMLArea.refreshPlugin(d);}if(typeof a._onGenerate=="function"){a._onGenerate();
}});};HTMLArea.prototype.registerPlugin=function(){var plugin=arguments[0];if(plugin==null||typeof plugin=="undefined"||(typeof plugin=="string"&&eval("typeof "+plugin)=="undefined")){return false;}var args=[];for(var i=1;i<arguments.length;++i){args.push(arguments[i]);}return this.registerPlugin2(plugin,args);
};HTMLArea.prototype.registerPlugin2=function(plugin,args){if(typeof plugin=="string"){plugin=eval(plugin);}if(typeof plugin=="undefined"){return false;}var obj=new plugin(this,args);if(obj){var clone={};var info=plugin._pluginInfo;for(var i in info){clone[i]=info[i];}clone.instance=obj;clone.args=args;
this.plugins[plugin._pluginInfo.name]=clone;return obj;}else{alert("Can't register plugin "+plugin.toString()+".");}};HTMLArea.getPluginDir=function(a){return _editor_url+"plugins/"+a;};HTMLArea.loadPlugin=function(pluginName,callback){if(eval("typeof "+pluginName)!="undefined"){if(callback){callback(pluginName);
}return true;}var dir=this.getPluginDir(pluginName);var plugin=pluginName.replace(/([a-z])([A-Z])([a-z])/g,function(str,l1,l2,l3){return l1+"-"+l2.toLowerCase()+l3;}).toLowerCase()+".js";var plugin_file=dir+"/"+plugin;if(callback){HTMLArea._loadback(plugin_file,function(){callback(pluginName);});}else{document.write("<script type='text/javascript' src='"+plugin_file+"'><\/script>");
}return false;};HTMLArea._pluginLoadStatus={};HTMLArea.loadPlugins=function(plugins,callbackIfNotReady){var retVal=true;var nuPlugins=HTMLArea.cloneObject(plugins);while(nuPlugins.length){var p=nuPlugins.pop();if(typeof HTMLArea._pluginLoadStatus[p]=="undefined"){HTMLArea._pluginLoadStatus[p]="loading";
HTMLArea.loadPlugin(p,function(plugin){if(eval("typeof "+plugin)!="undefined"){HTMLArea._pluginLoadStatus[plugin]="ready";}else{HTMLArea._pluginLoadStatus[plugin]="failed";}});retVal=false;}else{switch(HTMLArea._pluginLoadStatus[p]){case"failed":case"ready":break;case"loading":default:retVal=false;break;
}}}if(retVal){return true;}if(callbackIfNotReady){setTimeout(function(){if(HTMLArea.loadPlugins(plugins,callbackIfNotReady)){callbackIfNotReady();}},150);}return retVal;};HTMLArea.refreshPlugin=function(a){if(a&&typeof a.onGenerate=="function"){a.onGenerate();}if(a&&typeof a.onGenerateOnce=="function"){a.onGenerateOnce();
a.onGenerateOnce=null;}};HTMLArea.loadStyle=function(c,e){var a=_editor_url||"";if(typeof e!="undefined"){a+="plugins/"+e+"/";}a+=c;if(/^\//.test(c)){a=c;}var b=document.getElementsByTagName("head")[0];var d=document.createElement("link");d.rel="stylesheet";d.href=a;b.appendChild(d);};HTMLArea.loadStyle(typeof _editor_css=="string"?_editor_css:"htmlarea.css");
HTMLArea.prototype.debugTree=function(){var c=document.createElement("textarea");c.style.width="100%";c.style.height="20em";c.value="";function b(d,e){for(;--d>=0;){c.value+=" ";}c.value+=e+"\n";}function a(e,h){var d=e.tagName.toLowerCase(),f;var g=HTMLArea.is_ie?e.scopeName:e.prefix;b(h,"- "+d+" ["+g+"]");
for(f=e.firstChild;f;f=f.nextSibling){if(f.nodeType==1){a(f,h+2);}}}a(this._doc.body,0);document.body.appendChild(c);};HTMLArea.getInnerText=function(c){var a="",b;for(b=c.firstChild;b;b=b.nextSibling){if(b.nodeType==3){a+=b.data;}else{if(b.nodeType==1){a+=HTMLArea.getInnerText(b);}}}return a;};HTMLArea.prototype._wordClean=function(){var d=this,c={empty_tags:0,mso_class:0,mso_style:0,mso_xmlel:0,orig_len:this._doc.body.innerHTML.length,T:(new Date()).getTime()},h={empty_tags:"Empty tags removed: ",mso_class:"MSO class names removed: ",mso_style:"MSO inline style removed: ",mso_xmlel:"MSO XML elements stripped: "};
function a(){var j="HTMLArea word cleaner stats: \n\n";for(var k in c){if(h[k]){j+=h[k]+c[k]+"\n";}}j+="\nInitial document length: "+c.orig_len+"\n";j+="Final document length: "+d._doc.body.innerHTML.length+"\n";j+="Clean-up took "+(((new Date()).getTime()-c.T)/1000)+" seconds";alert(j);}function i(j){var k=j.className.replace(/(^|\s)mso.*?(\s|$)/ig," ");
if(k!=j.className){j.className=k;if(!/\S/.test(j.className)){j.removeAttribute("className");++c.mso_class;}}}function e(k){var l=k.style.cssText.split(/\s*;\s*/);for(var j=l.length;--j>=0;){if(/^mso|^tab-stops/i.test(l[j])||/^margin\s*:\s*0..\s+0..\s+0../i.test(l[j])){++c.mso_style;l.splice(j,1);}}k.style.cssText=l.join("; ");
}if(HTMLArea.is_ie){function g(j){j.outerHTML=HTMLArea.htmlEncode(j.innerText);++c.mso_xmlel;}}else{function g(k){var j=document.createTextNode(HTMLArea.getInnerText(k));k.parentNode.insertBefore(j,k);HTMLArea.removeFromParent(k);++c.mso_xmlel;}}function b(j){if(/^(a|span|b|strong|i|em|font)$/i.test(j.tagName)&&!j.firstChild){HTMLArea.removeFromParent(j);
++c.empty_tags;}}function f(k){var j=k.tagName.toLowerCase(),l,m;if((HTMLArea.is_ie&&k.scopeName!="HTML")||(!HTMLArea.is_ie&&/:/.test(j))){g(k);return false;}else{i(k);e(k);for(l=k.firstChild;l;l=m){m=l.nextSibling;if(l.nodeType==1&&f(l)){b(l);}}}return true;}f(this._doc.body);this.updateToolbar();};
HTMLArea.prototype._clearFonts=function(){var a=this.getInnerHTML();if(confirm(HTMLArea._lc("Would you like to clear font typefaces?"))){a=a.replace(/face="[^"]*"/gi,"");a=a.replace(/font-family:[^;}"']+;?/gi,"");}if(confirm(HTMLArea._lc("Would you like to clear font sizes?"))){a=a.replace(/size="[^"]*"/gi,"");
a=a.replace(/font-size:[^;}"']+;?/gi,"");}if(confirm(HTMLArea._lc("Would you like to clear font colours?"))){a=a.replace(/color="[^"]*"/gi,"");a=a.replace(/([^-])color:[^;}"']+;?/gi,"$1");}a=a.replace(/(style|class)="\s*"/gi,"");a=a.replace(/<(font|span)\s*>/gi,"");this.setHTML(a);this.updateToolbar();
};HTMLArea.prototype._splitBlock=function(){this._doc.execCommand("formatblock",false,"div");};HTMLArea.prototype.forceRedraw=function(){this._doc.body.style.visibility="hidden";this._doc.body.style.visibility="visible";};HTMLArea.prototype.focusEditor=function(){switch(this._editMode){case"wysiwyg":try{if(HTMLArea._someEditorHasBeenActivated){this.activateEditor();
this._iframe.contentWindow.focus();}}catch(a){}break;case"textmode":try{this._textArea.focus();}catch(a){}break;default:alert("ERROR: mode "+this._editMode+" is not defined");}return this._doc;};HTMLArea.prototype._undoTakeSnapshot=function(){++this._undoPos;if(this._undoPos>=this.config.undoSteps){this._undoQueue.shift();
--this._undoPos;}var b=true;var a=this.getInnerHTML();if(this._undoPos>0){b=(this._undoQueue[this._undoPos-1]!=a);}if(b){this._undoQueue[this._undoPos]=a;}else{this._undoPos--;}};HTMLArea.prototype.undo=function(){if(this._undoPos>0){var a=this._undoQueue[--this._undoPos];if(a){this.setHTML(a);}else{++this._undoPos;
}}};HTMLArea.prototype.redo=function(){if(this._undoPos<this._undoQueue.length-1){var a=this._undoQueue[++this._undoPos];if(a){this.setHTML(a);}else{--this._undoPos;}}};HTMLArea.prototype.disableToolbar=function(c){if(this._timerToolbar){clearTimeout(this._timerToolbar);}if(typeof c=="undefined"){c=[];
}else{if(typeof c!="object"){c=[c];}}for(var b in this._toolbarObjects){var a=this._toolbarObjects[b];if(c.contains(b)){continue;}if(typeof(a.state)!="function"){continue;}a.state("enabled",false);}};HTMLArea.prototype.enableToolbar=function(){this.updateToolbar();};if(!Array.prototype.contains){Array.prototype.contains=function(c){var b=this;
for(var a=0;a<b.length;a++){if(c==b[a]){return true;}}return false;};}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){var b=this;for(var a=0;a<b.length;a++){if(c==b[a]){return a;}}return null;};}HTMLArea.prototype.updateToolbar=function(noStatus){var doc=this._doc;var text=(this._editMode=="textmode");
var ancestors=null;if(!text){ancestors=this.getAllAncestors();if(this.config.statusBar&&!noStatus){this._statusBarTree.innerHTML=HTMLArea._lc("Path")+": ";for(var i=ancestors.length;--i>=0;){var el=ancestors[i];if(!el){continue;}var a=document.createElement("a");a.href="javascript:void(0)";a.el=el;a.editor=this;
HTMLArea.addDom0Event(a,"click",function(){this.blur();this.editor.selectNodeContents(this.el);this.editor.updateToolbar(true);return false;});HTMLArea.addDom0Event(a,"contextmenu",function(){this.blur();var info="Inline style:\n\n";info+=this.el.style.cssText.split(/;\s*/).join(";\n");alert(info);return false;
});var txt=el.tagName.toLowerCase();a.title=el.style.cssText;if(el.id){txt+="#"+el.id;}if(el.className){txt+="."+el.className;}a.appendChild(document.createTextNode(txt));this._statusBarTree.appendChild(a);if(i!=0){this._statusBarTree.appendChild(document.createTextNode(String.fromCharCode(187)));}}}}for(var i in this._toolbarObjects){var btn=this._toolbarObjects[i];
var cmd=i;var inContext=true;if(typeof(btn.state)!="function"){continue;}if(btn.context&&!text){inContext=false;var context=btn.context;var attrs=[];if(/(.*)\[(.*?)\]/.test(context)){context=RegExp.$1;attrs=RegExp.$2.split(",");}context=context.toLowerCase();var match=(context=="*");for(var k=0;k<ancestors.length;
++k){if(!ancestors[k]){continue;}if(match||(ancestors[k].tagName.toLowerCase()==context)){inContext=true;for(var ka=0;ka<attrs.length;++ka){if(!eval("ancestors[k]."+attrs[ka])){inContext=false;break;}}if(inContext){break;}}}}btn.state("enabled",(!text||btn.text)&&inContext);if(typeof cmd=="function"){continue;
}var dropdown=this.config.customSelects[cmd];if((!text||btn.text)&&(typeof dropdown!="undefined")){dropdown.refresh(this);continue;}switch(cmd){case"fontname":case"fontsize":if(!text){try{var value=(""+doc.queryCommandValue(cmd)).toLowerCase();if(!value){btn.element.selectedIndex=0;break;}var options=this.config[cmd];
var k=0;for(var j in options){if((j.toLowerCase()==value)||(options[j].substr(0,value.length).toLowerCase()==value)){btn.element.selectedIndex=k;throw"ok";}++k;}btn.element.selectedIndex=0;}catch(e){}}break;case"formatblock":var blocks=[];for(var i in this.config["formatblock"]){if(typeof(this.config["formatblock"][i])=="string"){blocks[blocks.length]=this.config["formatblock"][i];
}}var deepestAncestor=this._getFirstAncestor(this._getSelection(),blocks);if(deepestAncestor){for(var x=0;x<blocks.length;x++){if(blocks[x].toLowerCase()==deepestAncestor.tagName.toLowerCase()){btn.element.selectedIndex=x;}}}else{btn.element.selectedIndex=0;}break;case"textindicator":if(!text){try{with(btn.element.style){backgroundColor=HTMLArea._makeColor(doc.queryCommandValue(HTMLArea.is_ie?"backcolor":"hilitecolor"));
if(/transparent/i.test(backgroundColor)){backgroundColor=HTMLArea._makeColor(doc.queryCommandValue("backcolor"));}color=HTMLArea._makeColor(doc.queryCommandValue("forecolor"));fontFamily=doc.queryCommandValue("fontname");fontWeight=doc.queryCommandState("bold")?"bold":"normal";fontStyle=doc.queryCommandState("italic")?"italic":"normal";
}}catch(e){}}break;case"htmlmode":btn.state("active",text);break;case"lefttoright":case"righttoleft":var el=this.getParentElement();while(el&&!HTMLArea.isBlockElement(el)){el=el.parentNode;}if(el){btn.state("active",(el.style.direction==((cmd=="righttoleft")?"rtl":"ltr")));}break;default:cmd=cmd.replace(/(un)?orderedlist/i,"insert$1orderedlist");
try{btn.state("active",(!text&&doc.queryCommandState(cmd)));}catch(e){}}}if(this._customUndo&&!this._timerUndo){this._undoTakeSnapshot();var editor=this;this._timerUndo=setTimeout(function(){editor._timerUndo=null;},this.config.undoTimeout);}if(0&&HTMLArea.is_gecko){var s=this._getSelection();if(s&&s.isCollapsed&&s.anchorNode&&s.anchorNode.parentNode.tagName.toLowerCase()!="body"&&s.anchorNode.nodeType==3&&s.anchorOffset==s.anchorNode.length&&!(s.anchorNode.parentNode.nextSibling&&s.anchorNode.parentNode.nextSibling.nodeType==3)&&!HTMLArea.isBlockElement(s.anchorNode.parentNode)){try{s.anchorNode.parentNode.parentNode.insertBefore(this._doc.createTextNode("\t"),s.anchorNode.parentNode.nextSibling);
}catch(e){}}}for(var i in this.plugins){var plugin=this.plugins[i].instance;if(plugin&&typeof plugin.onUpdateToolbar=="function"){plugin.onUpdateToolbar();}}};if(!HTMLArea.is_ie){HTMLArea.prototype.insertNodeAtSelection=function(b){var d=this._getSelection();var a=this._createRange(d);d.removeAllRanges();
a.deleteContents();var c=a.startContainer;var f=a.startOffset;switch(c.nodeType){case 3:if(b.nodeType==3){c.insertData(f,b.data);a=this._createRange();a.setEnd(c,f+b.length);a.setStart(c,f+b.length);d.addRange(a);}else{c=c.splitText(f);var e=b;if(b.nodeType==11){e=e.firstChild;}c.parentNode.insertBefore(b,c);
this.selectNodeContents(e);this.updateToolbar();}break;case 1:var e=b;if(b.nodeType==11){e=e.firstChild;}c.insertBefore(b,c.childNodes[f]);this.selectNodeContents(e);this.updateToolbar();break;}};}else{HTMLArea.prototype.insertNodeAtSelection=function(a){return null;};}if(HTMLArea.is_ie){HTMLArea.prototype.getParentElement=function(d){if(typeof d=="undefined"){d=this._getSelection();
}var a=this._createRange(d);switch(d.type){case"Text":var c=a.parentElement();while(true){var b=a.duplicate();b.moveToElementText(c);if(b.inRange(a)){break;}if((c.nodeType!=1)||(c.tagName.toLowerCase()=="body")){break;}c=c.parentElement;}return c;case"None":return a.parentElement();case"Control":return a.item(0);
default:return this._doc.body;}};}else{HTMLArea.prototype.getParentElement=function(b){if(typeof b=="undefined"){b=this._getSelection();}var a=this._createRange(b);try{var d=a.commonAncestorContainer;if(!a.collapsed&&a.startContainer==a.endContainer&&a.startOffset-a.endOffset<=1&&a.startContainer.hasChildNodes()){d=a.startContainer.childNodes[a.startOffset];
}while(d.nodeType==3){d=d.parentNode;}return d;}catch(c){return null;}};}HTMLArea.prototype.getAllAncestors=function(){var c=this.getParentElement();var b=[];while(c&&(c.nodeType==1)&&(c.tagName.toLowerCase()!="body")){b.push(c);c=c.parentNode;}b.push(this._doc.body);return b;};HTMLArea.prototype._getFirstAncestor=function(c,b){var a=this._activeElement(c);
if(a==null){try{a=(HTMLArea.is_ie?this._createRange(c).parentElement():this._createRange(c).commonAncestorContainer);}catch(d){return null;}}if(typeof b=="string"){b=[b];}while(a){if(a.nodeType==1){if(b==null){return a;}if(b.contains(a.tagName.toLowerCase())){return a;}if(a.tagName.toLowerCase()=="body"){break;
}if(a.tagName.toLowerCase()=="table"){break;}}a=a.parentNode;}return null;};if(HTMLArea.is_ie){HTMLArea.prototype._activeElement=function(c){if((c==null)||this._selectionEmpty(c)){return null;}if(c.type.toLowerCase()=="control"){return c.createRange().item(0);}else{var b=c.createRange();var a=this.getParentElement(c);
if(a.innerHTML==b.htmlText){return a;}return null;}};}else{HTMLArea.prototype._activeElement=function(a){if((a==null)||this._selectionEmpty(a)){return null;}if(!a.isCollapsed){if(a.anchorNode.childNodes.length>a.anchorOffset&&a.anchorNode.childNodes[a.anchorOffset].nodeType==1){return a.anchorNode.childNodes[a.anchorOffset];
}else{if(a.anchorNode.nodeType==1){return a.anchorNode;}else{return a.anchorNode.parentNode;}}}return null;};}if(HTMLArea.is_ie){HTMLArea.prototype._selectionEmpty=function(a){if(!a){return true;}return this._createRange(a).htmlText=="";};}else{HTMLArea.prototype._selectionEmpty=function(a){if(!a){return true;
}if(typeof a.isCollapsed!="undefined"){return a.isCollapsed;}return true;};}HTMLArea.prototype._getAncestorBlock=function(b){var a=(HTMLArea.is_ie?this._createRange(b).parentElement:this._createRange(b).commonAncestorContainer);while(a&&(a.nodeType==1)){switch(a.tagName.toLowerCase()){case"div":case"p":case"address":case"blockquote":case"center":case"del":case"ins":case"pre":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"h7":return a;
case"body":case"noframes":case"dd":case"li":case"th":case"td":case"noscript":return null;default:break;}}return null;};HTMLArea.prototype._createImplicitBlock=function(b){var c=this._getSelection();if(HTMLArea.is_ie){c.empty();}else{c.collapseToStart();}var a=this._createRange(c);};HTMLArea.prototype._formatBlock=function(a){var l=this.getAllAncestors();
var f=null;var g=null;var h=[];if(a.indexOf(".")>=0){g=a.substr(0,a.indexOf(".")).toLowerCase();h=a.substr(a.indexOf("."),a.length-a.indexOf(".")).replace(/\./g,"").replace(/^\s*/,"").replace(/\s*$/,"").split(" ");}else{g=a.toLowerCase();}var c=this._getSelection();var b=this._createRange(c);var f=null;
if(HTMLArea.is_gecko){if(c.isCollapsed){f=this._getAncestorBlock(c);if(f==null){f=this._createImplicitBlock(c,g);}}else{switch(g){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"h7":f=[];var d=["h1","h2","h3","h4","h5","h6","h7"];for(var i=0;i<d.length;i++){var e=this._doc.getElementsByTagName(search_tag[i]);
for(var j=0;j<e.length;j++){if(c.containsNode(e[j])){f[f.length]=e[j];}}}if(f.length>0){break;}case"div":f=this._doc.createElement(g);f.appendChild(b.extractContents());b.insertNode(f);break;case"p":case"center":case"pre":case"ins":case"del":case"blockquote":case"address":f=[];var k=this._doc.getElementsByTagName(g);
for(var j=0;j<k.length;j++){if(c.containsNode(k[j])){f[f.length]=k[j];}}if(f.length==0){c.collapseToStart();return this._formatBlock(a);}break;}}}};if(HTMLArea.is_ie){HTMLArea.prototype.selectNodeContents=function(b,d){this.focusEditor();this.forceRedraw();var a;var c=typeof d=="undefined"?true:false;
if(c&&b.tagName&&b.tagName.toLowerCase().match(/table|img|input|select|textarea/)){a=this._doc.body.createControlRange();a.add(b);}else{a=this._doc.body.createTextRange();a.moveToElementText(b);}a.select();};}else{HTMLArea.prototype.selectNodeContents=function(b,e){this.focusEditor();this.forceRedraw();
var a;var d=typeof e=="undefined"?true:false;var c=this._getSelection();a=this._doc.createRange();if(d&&b.tagName&&b.tagName.toLowerCase().match(/table|img|input|textarea|select/)){a.selectNode(b);}else{a.selectNodeContents(b);}c.removeAllRanges();c.addRange(a);};}if(HTMLArea.is_ie){HTMLArea.prototype.insertHTML=function(b){var c=this._getSelection();
var a=this._createRange(c);this.focusEditor();a.pasteHTML(b);};}else{HTMLArea.prototype.insertHTML=function(c){var e=this._getSelection();var a=this._createRange(e);this.focusEditor();var b=this._doc.createDocumentFragment();var f=this._doc.createElement("div");f.innerHTML=c;while(f.firstChild){b.appendChild(f.firstChild);
}var d=this.insertNodeAtSelection(b);};}HTMLArea.prototype.surroundHTML=function(c,b){var a=this.getSelectedHTML();this.insertHTML(c+a+b);};if(HTMLArea.is_ie){HTMLArea.prototype.getSelectedHTML=function(){var b=this._getSelection();var a=this._createRange(b);return a.htmlText;};}else{HTMLArea.prototype.getSelectedHTML=function(){var b=this._getSelection();
var a=this._createRange(b);return HTMLArea.getHTML(a.cloneContents(),false,this);};}HTMLArea.prototype.hasSelectedText=function(){return this.getSelectedHTML()!="";};HTMLArea.prototype._createLink=function(c){var b=this;var f=null;if(typeof c=="undefined"){c=this.getParentElement();if(c){while(c&&!/^a$/i.test(c.tagName)){c=c.parentNode;
}}}if(!c){var e=b._getSelection();var a=b._createRange(e);var d=0;if(HTMLArea.is_ie){if(e.type=="Control"){d=a.length;}else{d=a.compareEndPoints("StartToEnd",a);}}else{d=a.compareBoundaryPoints(a.START_TO_END,a);}if(d==0){alert(HTMLArea._lc("You need to select some text before creating a link"));return;
}f={f_href:"",f_title:"",f_target:"",f_usetarget:b.config.makeLinkShowsTarget};}else{f={f_href:HTMLArea.is_ie?b.stripBaseURL(c.href):c.getAttribute("href"),f_title:c.title,f_target:c.target,f_usetarget:b.config.makeLinkShowsTarget};}this._popupDialog(b.config.URIs["link"],function(l){if(!l){return false;
}var g=c;if(!g){try{b._doc.execCommand("createlink",false,l.f_href);g=b.getParentElement();var j=b._getSelection();var i=b._createRange(j);if(!HTMLArea.is_ie){g=i.startContainer;if(!/^a$/i.test(g.tagName)){g=g.nextSibling;if(g==null){g=i.startContainer.parentNode;}}}}catch(k){}}else{var h=l.f_href.trim();
b.selectNodeContents(g);if(h==""){b._doc.execCommand("unlink",false,null);b.updateToolbar();return false;}else{g.href=h;}}if(!(g&&/^a$/i.test(g.tagName))){return false;}g.target=l.f_target.trim();g.title=l.f_title.trim();b.selectNodeContents(g);b.updateToolbar();},f);};HTMLArea.prototype._insertImage=function(b){var a=this;
var c=null;if(typeof b=="undefined"){b=this.getParentElement();if(b&&!/^img$/i.test(b.tagName)){b=null;}}if(b){c={f_base:a.config.baseHref,f_url:HTMLArea.is_ie?a.stripBaseURL(b.src):b.getAttribute("src"),f_alt:b.alt,f_border:b.border,f_align:b.align,f_vert:b.vspace,f_horiz:b.hspace};}this._popupDialog(a.config.URIs["insert_image"],function(i){if(!i){return false;
}var e=b;if(!e){if(HTMLArea.is_ie){var g=a._getSelection();var d=a._createRange(g);a._doc.execCommand("insertimage",false,i.f_url);e=d.parentElement();if(e.tagName.toLowerCase()!="img"){e=e.previousSibling;}}else{e=document.createElement("img");e.src=i.f_url;a.insertNodeAtSelection(e);if(!e.tagName){e=d.startContainer.firstChild;
}}}else{e.src=i.f_url;}for(var h in i){var f=i[h];switch(h){case"f_alt":e.alt=f;break;case"f_border":e.border=parseInt(f||"0");break;case"f_align":e.align=f;break;case"f_vert":e.vspace=parseInt(f||"0");break;case"f_horiz":e.hspace=parseInt(f||"0");break;}}},c);};HTMLArea.prototype._insertTable=function(){var c=this._getSelection();
var a=this._createRange(c);var b=this;this._popupDialog(b.config.URIs["insert_table"],function(d){if(!d){return false;}var n=b._doc;var p=n.createElement("table");for(var m in d){var o=d[m];if(!o){continue;}switch(m){case"f_width":p.style.width=o+d["f_unit"];break;case"f_align":p.align=o;break;case"f_border":p.border=parseInt(o);
break;case"f_spacing":p.cellSpacing=parseInt(o);break;case"f_padding":p.cellPadding=parseInt(o);break;}}var k=0;if(d.f_fixed){k=Math.floor(100/parseInt(d.f_cols));}var h=n.createElement("tbody");p.appendChild(h);for(var g=0;g<d["f_rows"];++g){var l=n.createElement("tr");h.appendChild(l);for(var f=0;f<d["f_cols"];
++f){var e=n.createElement("td");if(k){e.style.width=k+"%";}l.appendChild(e);e.appendChild(n.createTextNode("\u00a0"));}}if(HTMLArea.is_ie){a.pasteHTML(p.outerHTML);}else{b.insertNodeAtSelection(p);}return true;},null);};HTMLArea.prototype._comboSelected=function(b,a){this.focusEditor();var c=b.options[b.selectedIndex].value;
switch(a){case"fontname":case"fontsize":this.execCommand(a,false,c);break;case"formatblock":if(!HTMLArea.is_gecko||c!=="blockquote"){c="<"+c+">";}this.execCommand(a,false,c);break;default:var d=this.config.customSelects[a];if(typeof d!="undefined"){d.action(this);}else{alert("FIXME: combo box "+a+" not implemented");
}}};HTMLArea.prototype.execCommand=function(h,f,g){var c=this;this.focusEditor();h=h.toLowerCase();if(HTMLArea.is_gecko){try{this._doc.execCommand("useCSS",false,true);}catch(d){}}switch(h){case"htmlmode":this.setMode();break;case"hilitecolor":(HTMLArea.is_ie)&&(h="backcolor");if(HTMLArea.is_gecko){try{c._doc.execCommand("useCSS",false,false);
}catch(d){}}case"forecolor":this._popupDialog(c.config.URIs["select_color"],function(e){if(e){c._doc.execCommand(h,false,"#"+e);}},HTMLArea._colorToRgb(this._doc.queryCommandValue(h)));break;case"createlink":this._createLink();break;case"undo":case"redo":if(this._customUndo){this[h]();}else{this._doc.execCommand(h,f,g);
}break;case"inserttable":this._insertTable();break;case"insertimage":this._insertImage();break;case"about":this._popupDialog(c.config.URIs["about"],null,this);break;case"showhelp":this._popupDialog(c.config.URIs["help"],null,this);break;case"killword":this._wordClean();break;case"cut":case"copy":case"paste":try{this._doc.execCommand(h,f,g);
if(this.config.killWordOnPaste){this._wordClean();}}catch(d){if(HTMLArea.is_gecko){alert(HTMLArea._lc("The Paste button does not work in Mozilla based web browsers (technical security reasons). Press CTRL-V on your keyboard to paste directly."));}}break;case"lefttoright":case"righttoleft":var a=(h=="righttoleft")?"rtl":"ltr";
var b=this.getParentElement();while(b&&!HTMLArea.isBlockElement(b)){b=b.parentNode;}if(b){if(b.style.direction==a){b.style.direction="";}else{b.style.direction=a;}}break;default:try{this._doc.execCommand(h,f,g);}catch(d){if(this.config.debug){alert(d+"\n\nby execCommand("+h+");");}}}this.updateToolbar();
return false;};HTMLArea.prototype._editorEvent=function(w){var d=this;var u=(HTMLArea.is_ie&&w.type=="keydown")||(!HTMLArea.is_ie&&w.type=="keypress");if(typeof d._textArea["on"+w.type]=="function"){d._textArea["on"+w.type]();}if(HTMLArea.is_gecko&&u&&w.ctrlKey&&this._unLink&&this._unlinkOnUndo){if(String.fromCharCode(w.charCode).toLowerCase()=="z"){HTMLArea._stopEvent(w);
this._unLink();d.updateToolbar();return;}}if(u){for(var r in d.plugins){var c=d.plugins[r].instance;if(c&&typeof c.onKeyPress=="function"){if(c.onKeyPress(w)){return false;}}}}if(u&&w.ctrlKey&&!w.altKey){var o=null;var j=null;var z=String.fromCharCode(HTMLArea.is_ie?w.keyCode:w.charCode).toLowerCase();
var q=null;var l=null;switch(z){case"a":if(!HTMLArea.is_ie){o=this._getSelection();o.removeAllRanges();j=this._createRange();j.selectNodeContents(this._doc.body);o.addRange(j);HTMLArea._stopEvent(w);}break;case"b":q="bold";break;case"i":q="italic";break;case"u":q="underline";break;case"s":q="strikethrough";
break;case"l":q="justifyleft";break;case"e":q="justifycenter";break;case"r":q="justifyright";break;case"j":q="justifyfull";break;case"z":q="undo";break;case"y":q="redo";break;case"v":if(HTMLArea.is_ie||d.config.htmlareaPaste){q="paste";}break;case"n":q="formatblock";l=HTMLArea.is_ie?"<p>":"p";break;case"0":q="killword";
break;case"1":case"2":case"3":case"4":case"5":case"6":q="formatblock";l="h"+z;if(HTMLArea.is_ie){l="<"+l+">";}break;}if(q){this.execCommand(q,false,l);HTMLArea._stopEvent(w);}}else{if(u){if(HTMLArea.is_gecko){var h=d._getSelection();var e=function(B,i){var s=B.nextSibling;if(typeof i=="string"){i=d._doc.createElement(i);
}var m=B.parentNode.insertBefore(i,s);HTMLArea.removeFromParent(B);m.appendChild(B);s.data=" "+s.data;if(HTMLArea.is_ie){var A=d._createRange(h);h.moveToElementText(s);h.move("character",1);}else{h.collapse(s,1);}HTMLArea._stopEvent(w);d._unLink=function(){var a=m.firstChild;m.removeChild(a);m.parentNode.insertBefore(a,m);
HTMLArea.removeFromParent(m);d._unLink=null;d._unlinkOnUndo=false;};d._unlinkOnUndo=true;return m;};switch(w.which){case 32:if(h&&h.isCollapsed&&h.anchorNode.nodeType==3&&h.anchorNode.data.length>3&&h.anchorNode.data.indexOf(".")>=0){var v=h.anchorNode.data.substring(0,h.anchorOffset).search(/\S{4,}$/);
if(v==-1){break;}if(this._getFirstAncestor(h,"a")){break;}var f=h.anchorNode.data.substring(0,h.anchorOffset).replace(/^.*?(\S*)$/,"$1");var n=f.match(HTMLArea.RE_email);if(n){var p=h.anchorNode;var b=p.splitText(h.anchorOffset);var t=p.splitText(v);e(t,"a").href="mailto:"+n[0];break;}var n=f.match(HTMLArea.RE_url);
if(n){var p=h.anchorNode;var b=p.splitText(h.anchorOffset);var t=p.splitText(v);e(t,"a").href=(n[1]?n[1]:"http://")+n[2];break;}}break;default:if(w.keyCode==27||(this._unlinkOnUndo&&w.ctrlKey&&w.which==122)){if(this._unLink){this._unLink();HTMLArea._stopEvent(w);}break;}else{if(w.which||w.keyCode==8||w.keyCode==46){this._unlinkOnUndo=false;
if(h.anchorNode&&h.anchorNode.nodeType==3){var y=this._getFirstAncestor(h,"a");if(!y){break;}if(!y._updateAnchTimeout){if(h.anchorNode.data.match(HTMLArea.RE_email)&&(y.href.match("mailto:"+h.anchorNode.data.trim()))){var k=h.anchorNode;var g=function(){y.href="mailto:"+k.data.trim();y._updateAnchTimeout=setTimeout(g,250);
};y._updateAnchTimeout=setTimeout(g,250);break;}var n=h.anchorNode.data.match(HTMLArea.RE_url);if(n&&y.href.match(h.anchorNode.data.trim())){var k=h.anchorNode;var g=function(){var a=k.data.match(HTMLArea.RE_url);y.href=(a[1]?a[1]:"http://")+a[2];y._updateAnchTimeout=setTimeout(g,250);};y._updateAnchTimeout=setTimeout(g,250);
}}}}}break;}}switch(w.keyCode){case 13:if(HTMLArea.is_gecko&&!w.shiftKey&&this.config.mozParaHandler=="dirty"){this.dom_checkInsertP();HTMLArea._stopEvent(w);}break;case 8:case 46:if((HTMLArea.is_gecko&&!w.shiftKey)||HTMLArea.is_ie){if(this.checkBackspace()){HTMLArea._stopEvent(w);}}break;}}}if(d._timerToolbar){clearTimeout(d._timerToolbar);
}d._timerToolbar=setTimeout(function(){d.updateToolbar();d._timerToolbar=null;},250);};HTMLArea.prototype.convertNode=function(a,c){var b=this._doc.createElement(c);while(a.firstChild){b.appendChild(a.firstChild);}return b;};if(HTMLArea.is_ie){HTMLArea.prototype.checkBackspace=function(){var e=this._getSelection();
if(e.type=="Control"){var f=this._activeElement(e);HTMLArea.removeFromParent(f);return true;}var d=this._createRange(e);var c=d.duplicate();c.moveStart("character",-1);var b=c.parentElement();if(b!=d.parentElement()&&/^a$/i.test(b.tagName)){c.collapse(true);c.moveEnd("character",1);c.pasteHTML("");c.select();
return true;}};}else{HTMLArea.prototype.checkBackspace=function(){var a=this;setTimeout(function(){var e=a._getSelection();var g=a._createRange(e);var f=g.startContainer;var i=g.startOffset;var c=g.endContainer;var h=g.endOffset;var j=f.nextSibling;if(f.nodeType==3){f=f.parentNode;}if(!/\S/.test(f.tagName)){var d=document.createElement("p");
while(f.firstChild){d.appendChild(f.firstChild);}f.parentNode.insertBefore(d,f);HTMLArea.removeFromParent(f);var b=g.cloneRange();b.setStartBefore(j);b.setEndAfter(j);b.extractContents();e.removeAllRanges();e.addRange(b);}},10);};}HTMLArea.prototype.dom_checkInsertP=function(){var m=this._getSelection();
var j=this._createRange(m);if(!j.collapsed){j.deleteContents();}this.deactivateEditor();var r=j.startContainer;var k=j.startOffset;var a=j.endContainer;var q=j.endOffset;if(r==a&&r==g&&!k&&!q){l=this._doc.createTextNode(" ");g.insertBefore(l,g.firstChild);j.selectNodeContents(l);r=j.startContainer;k=j.startOffset;
a=j.endContainer;q=j.endOffset;}var l=this.getAllAncestors();var e=null;var g=this._doc.body;for(var o=0;o<l.length;++o){if(HTMLArea.isParaContainer(l[o])){break;}else{if(HTMLArea.isBlockElement(l[o])&&!/body|html/i.test(l[o].tagName)){e=l[o];break;}}}if(!e){var f=j.startContainer;while(f.parentNode&&!HTMLArea.isParaContainer(f.parentNode)){f=f.parentNode;
}var c=f;var b=f;while(c.previousSibling){if(c.previousSibling.tagName){if(!HTMLArea.isBlockElement(c.previousSibling)){c=c.previousSibling;}else{break;}}else{c=c.previousSibling;}}while(b.nextSibling){if(b.nextSibling.tagName){if(!HTMLArea.isBlockElement(b.nextSibling)){b=b.nextSibling;}else{break;}}else{b=b.nextSibling;
}}j.setStartBefore(c);j.setEndAfter(b);j.surroundContents(this._doc.createElement("p"));e=j.startContainer.firstChild;j.setStart(r,k);}j.setEndAfter(e);var n=j.cloneRange();m.removeRange(j);var t=n.extractContents();if(t.childNodes.length==0){t.appendChild(this._doc.createElement("p"));t.firstChild.appendChild(this._doc.createElement("br"));
}if(t.childNodes.length>1){var d=this._doc.createElement("p");while(t.firstChild){var h=t.firstChild;t.removeChild(h);d.appendChild(h);}t.appendChild(d);}if(!/\S/.test(e.innerHTML)){e.innerHTML="&nbsp;";}l=t.firstChild;if(!/\S/.test(l.innerHTML)){l.innerHTML="<br />";}if(/^\s*<br\s*\/?>\s*$/.test(l.innerHTML)&&/^h[1-6]$/i.test(l.tagName)){t.appendChild(this.convertNode(l,"p"));
t.removeChild(l);}var u=e.parentNode.insertBefore(t.firstChild,e.nextSibling);this.activateEditor();var m=this._getSelection();m.removeAllRanges();m.collapse(u,0);this.scrollToElement(u);};HTMLArea.prototype.scrollToElement=function(c){if(HTMLArea.is_gecko){var b=0;var a=0;while(c){b+=c.offsetTop;a+=c.offsetLeft;
if(c.offsetParent&&c.offsetParent.tagName.toLowerCase()!="body"){c=c.offsetParent;}else{c=null;}}this._iframe.contentWindow.scrollTo(a,b);}};HTMLArea.prototype.getHTML=function(){var a="";switch(this._editMode){case"wysiwyg":if(!this.config.fullPage){a=HTMLArea.getHTML(this._doc.body,false,this);}else{a=this.doctype+"\n"+HTMLArea.getHTML(this._doc.documentElement,true,this);
}break;case"textmode":a=this._textArea.value;break;default:alert("Mode <"+mode+"> not defined!");return false;}return a;};HTMLArea.prototype.outwardHtml=function(b){b=b.replace(/<(\/?)b(\s|>|\/)/ig,"<$1strong$2");b=b.replace(/<(\/?)i(\s|>|\/)/ig,"<$1em$2");b=b.replace(/<(\/?)strike(\s|>|\/)/ig,"<$1del$2");
b=b.replace("onclick=\"try{if(document.designMode &amp;&amp; document.designMode == 'on') return false;}catch(e){} window.open(",'onclick="window.open(');var a=location.href.replace(/(https?:\/\/[^\/]*)\/.*/,"$1")+"/";b=b.replace(/https?:\/\/null\//g,a);b=b.replace(/((href|src|background)=[\'\"])\/+/ig,"$1"+a);
b=this.outwardSpecialReplacements(b);b=this.fixRelativeLinks(b);if(this.config.sevenBitClean){b=b.replace(/[^ -~\r\n\t]/g,function(d){return"&#"+d.charCodeAt(0)+";";});}if(HTMLArea.is_gecko){b=b.replace(/<script[\s]*src[\s]*=[\s]*['"]chrome:\/\/.*?["']>[\s]*<\/script>/ig,"");}return b;};HTMLArea.prototype.inwardHtml=function(a){if(HTMLArea.is_gecko){a=a.replace(/<(\/?)strong(\s|>|\/)/ig,"<$1b$2");
a=a.replace(/<(\/?)em(\s|>|\/)/ig,"<$1i$2");}a=a.replace(/<(\/?)del(\s|>|\/)/ig,"<$1strike$2");a=a.replace('onclick="window.open(',"onclick=\"try{if(document.designMode &amp;&amp; document.designMode == 'on') return false;}catch(e){} window.open(");a=this.inwardSpecialReplacements(a);var b=new RegExp("((href|src|background)=['\"])/+","gi");
a=a.replace(b,"$1"+location.href.replace(/(https?:\/\/[^\/]*)\/.*/,"$1")+"/");a=this.fixRelativeLinks(a);return a;};HTMLArea.prototype.outwardSpecialReplacements=function(b){for(var a in this.config.specialReplacements){var e=this.config.specialReplacements[a];var d=a;if(typeof(e.replace)!="function"||typeof(d.replace)!="function"){continue;
}var c=new RegExp(e.replace(HTMLArea.RE_Specials,"\\$1"),"g");b=b.replace(c,d.replace(/\$/g,"$$$$"));}return b;};HTMLArea.prototype.inwardSpecialReplacements=function(b){for(var a in this.config.specialReplacements){var e=a;var d=this.config.specialReplacements[a];if(typeof(e.replace)!="function"||typeof(d.replace)!="function"){continue;
}var c=new RegExp(e.replace(HTMLArea.RE_Specials,"\\$1"),"g");b=b.replace(c,d.replace(/\$/g,"$$$$"));}return b;};HTMLArea.prototype.fixRelativeLinks=function(a){if(typeof this.config.stripSelfNamedAnchors!="undefined"&&this.config.stripSelfNamedAnchors){var c=new RegExp(document.location.href.replace(HTMLArea.RE_Specials,"\\$1")+"(#[^'\" ]*)","g");
a=a.replace(c,"$1");}if(typeof this.config.stripBaseHref!="undefined"&&this.config.stripBaseHref){var b=null;if(typeof this.config.baseHref!="undefined"&&this.config.baseHref!=null){b=new RegExp(this.config.baseHref.replace(HTMLArea.RE_Specials,"\\$1"),"g");}else{b=new RegExp(document.location.href.replace(/([^\/]*\/?)$/,"").replace(HTMLArea.RE_Specials,"\\$1"),"g");
}a=a.replace(b,"");}if(HTMLArea.is_ie){}return a;};HTMLArea.prototype.getInnerHTML=function(){if(!this._doc.body){return"";}switch(this._editMode){case"wysiwyg":if(!this.config.fullPage){html=this._doc.body.innerHTML;}else{html=this.doctype+"\n"+this._doc.documentElement.innerHTML;}break;case"textmode":html=this._textArea.value;
break;default:alert("Mode <"+mode+"> not defined!");return false;}return html;};HTMLArea.prototype.setHTML=function(a){if(!this.config.fullPage){this._doc.body.innerHTML=a;}else{this.setFullHTML(a);}this._textArea.value=a;};HTMLArea.prototype.setDoctype=function(a){this.doctype=a;};HTMLArea._object=null;
HTMLArea.cloneObject=function(c){if(!c){return null;}var a=new Object;if(c.constructor.toString().match(/\s*function Array\(/)){a=c.constructor();}if(c.constructor.toString().match(/\s*function Function\(/)){a=c;}else{for(var d in c){var b=c[d];if(typeof b=="object"){a[d]=HTMLArea.cloneObject(b);}else{a[d]=b;
}}}return a;};HTMLArea.checkSupportedBrowser=function(){if(HTMLArea.is_gecko){if(navigator.productSub<20021201){alert("You need at least Mozilla-1.3 Alpha.\n"+"Sorry, your Gecko is not supported.");return false;}if(navigator.productSub<20030210){alert("Mozilla < 1.3 Beta is not supported!\n"+"I'll try, though, but it might not work.");
}}return HTMLArea.is_gecko||HTMLArea.is_ie;};if(HTMLArea.is_ie){HTMLArea.prototype._getSelection=function(){return this._doc.selection;};}else{HTMLArea.prototype._getSelection=function(){return this._iframe.contentWindow.getSelection();};}if(HTMLArea.is_ie){HTMLArea.prototype._createRange=function(a){return a.createRange();
};}else{HTMLArea.prototype._createRange=function(a){this.activateEditor();if(typeof a!="undefined"){try{return a.getRangeAt(0);}catch(b){return this._doc.createRange();}}else{return this._doc.createRange();}};}HTMLArea._eventFlushers=[];HTMLArea.flushEvents=function(){var a=0;var b=null;while(b=HTMLArea._eventFlushers.pop()){try{if(b.length==3){HTMLArea._removeEvent(b[0],b[1],b[2]);
a++;}else{if(b.length==2){b[0]["on"+b[1]]=null;b[0]._xinha_dom0Events[b[1]]=null;a++;}}}catch(b){}}};if(document.addEventListener){HTMLArea._addEvent=function(a,c,b){a.addEventListener(c,b,true);HTMLArea._eventFlushers.push([a,c,b]);};HTMLArea._removeEvent=function(a,c,b){a.removeEventListener(c,b,true);
};HTMLArea._stopEvent=function(a){a.preventDefault();a.stopPropagation();};}else{if(document.attachEvent){HTMLArea._addEvent=function(a,c,b){a.attachEvent("on"+c,b);HTMLArea._eventFlushers.push([a,c,b]);};HTMLArea._removeEvent=function(a,c,b){a.detachEvent("on"+c,b);};HTMLArea._stopEvent=function(a){try{a.cancelBubble=true;
a.returnValue=false;}catch(b){}};}else{HTMLArea._addEvent=function(a,c,b){alert("_addEvent is not supported");};HTMLArea._removeEvent=function(a,c,b){alert("_removeEvent is not supported");};HTMLArea._stopEvent=function(a){alert("_stopEvent is not supported");};}}HTMLArea._addEvents=function(c,a,d){for(var b=a.length;
--b>=0;){HTMLArea._addEvent(c,a[b],d);}};HTMLArea._removeEvents=function(c,a,d){for(var b=a.length;--b>=0;){HTMLArea._removeEvent(c,a[b],d);}};HTMLArea.addDom0Event=function(b,c,a){HTMLArea._prepareForDom0Events(b,c);b._xinha_dom0Events[c].unshift(a);};HTMLArea.prependDom0Event=function(b,c,a){HTMLArea._prepareForDom0Events(b,c);
b._xinha_dom0Events[c].push(a);};HTMLArea._prepareForDom0Events=function(a,b){if(typeof a._xinha_dom0Events=="undefined"){a._xinha_dom0Events={};HTMLArea.freeLater(a,"_xinha_dom0Events");}if(typeof a._xinha_dom0Events[b]=="undefined"){a._xinha_dom0Events[b]=[];if(typeof a["on"+b]=="function"){a._xinha_dom0Events[b].push(a["on"+b]);
}a["on"+b]=function(e){var c=a._xinha_dom0Events[b];var f=true;for(var d=c.length;--d>=0;){a._xinha_tempEventHandler=c[d];if(a._xinha_tempEventHandler(e)==false){a._xinha_tempEventHandler=null;f=false;break;}a._xinha_tempEventHandler=null;}return f;};HTMLArea._eventFlushers.push([a,b]);}};HTMLArea.prototype.notifyOn=function(b,a){if(typeof this._notifyListeners[b]=="undefined"){this._notifyListeners[b]=[];
HTMLArea.freeLater(this,"_notifyListeners");}this._notifyListeners[b].push(a);};HTMLArea.prototype.notifyOf=function(c,a){if(this._notifyListeners[c]){for(var b=0;b<this._notifyListeners[c].length;b++){this._notifyListeners[c][b](c,a);}}};HTMLArea._removeClass=function(e,d){if(!(e&&e.className)){return;
}var a=e.className.split(" ");var b=new Array();for(var c=a.length;c>0;){if(a[--c]!=d){b[b.length]=a[c];}}e.className=b.join(" ");};HTMLArea._addClass=function(b,a){HTMLArea._removeClass(b,a);b.className+=" "+a;};HTMLArea._hasClass=function(d,c){if(!(d&&d.className)){return false;}var a=d.className.split(" ");
for(var b=a.length;b>0;){if(a[--b]==c){return true;}}return false;};HTMLArea._blockTags=" body form textarea fieldset ul ol dl li div "+"p h1 h2 h3 h4 h5 h6 quote pre table thead "+"tbody tfoot tr td th iframe address blockquote";HTMLArea.isBlockElement=function(a){return a&&a.nodeType==1&&(HTMLArea._blockTags.indexOf(" "+a.tagName.toLowerCase()+" ")!=-1);
};HTMLArea._paraContainerTags=" body td th caption fieldset div";HTMLArea.isParaContainer=function(a){return a&&a.nodeType==1&&(HTMLArea._paraContainerTags.indexOf(" "+a.tagName.toLowerCase()+" ")!=-1);};HTMLArea._closingTags=" a abbr acronym address applet b bdo big blockquote button caption center cite code del dfn dir div dl em fieldset font form frameset h1 h2 h3 h4 h5 h6 i iframe ins kbd label legend map menu noframes noscript object ol optgroup pre q s samp script select small span strike strong style sub sup table textarea title tt u ul var ";
HTMLArea.needsClosingTag=function(a){return a&&a.nodeType==1&&(HTMLArea._closingTags.indexOf(" "+a.tagName.toLowerCase()+" ")!=-1);};HTMLArea.htmlEncode=function(a){if(typeof a.replace=="undefined"){a=a.toString();}a=a.replace(/&/ig,"&amp;");a=a.replace(/</ig,"&lt;");a=a.replace(/>/ig,"&gt;");a=a.replace(/\xA0/g,"&nbsp;");
a=a.replace(/\x22/g,"&quot;");return a;};HTMLArea.getHTML=function(a,c,b){try{return HTMLArea.getHTMLWrapper(a,c,b);}catch(d){alert(HTMLArea._lc("Your Document is not well formed. Check JavaScript console for details."));return b._iframe.contentWindow.document.body.innerHTML;}};HTMLArea.getHTMLWrapper=function(l,c,j,d){var h="";
if(!d){d="";}switch(l.nodeType){case 10:case 6:case 12:break;case 2:break;case 4:h+=(HTMLArea.is_ie?("\n"+d):"")+"<![CDATA["+l.data+"]]>";break;case 5:h+="&"+l.nodeValue+";";break;case 7:h+=(HTMLArea.is_ie?("\n"+d):"")+"<?"+l.target+" "+l.data+" ?>";break;case 1:case 11:case 9:var k;var g;var o=(l.nodeType==1)?l.tagName.toLowerCase():"";
if(c){c=!(j.config.htmlRemoveTags&&j.config.htmlRemoveTags.test(o));}if(HTMLArea.is_ie&&o=="head"){if(c){h+=(HTMLArea.is_ie?("\n"+d):"")+"<head>";}var q=RegExp.multiline;RegExp.multiline=true;var f=l.innerHTML.replace(HTMLArea.RE_tagName,function(r,i,a){return i+a.toLowerCase();});RegExp.multiline=q;
h+=f+"\n";if(c){h+=(HTMLArea.is_ie?("\n"+d):"")+"</head>";}break;}else{if(c){k=(!(l.hasChildNodes()||HTMLArea.needsClosingTag(l)));h+=(HTMLArea.is_ie&&HTMLArea.isBlockElement(l)?("\n"+d):"")+"<"+l.tagName.toLowerCase();var p=l.attributes;for(g=0;g<p.length;++g){var m=p.item(g);if(!m.specified&&!(l.tagName.toLowerCase().match(/input|option/)&&m.nodeName=="value")){continue;
}var b=m.nodeName.toLowerCase();if(/_moz_editor_bogus_node/.test(b)){h="";break;}if(/(_moz)|(contenteditable)|(_msh)/.test(b)){continue;}var n;if(b!="style"){if(typeof l[m.nodeName]!="undefined"&&b!="href"&&b!="src"&&!/^on/.test(b)){n=l[m.nodeName];}else{n=m.nodeValue;if(HTMLArea.is_ie&&(b=="href"||b=="src")){n=j.stripBaseURL(n);
}if(j.config.only7BitPrintablesInURLs&&(b=="href"||b=="src")){n=n.replace(/([^!-~]+)/g,function(a){return escape(a);});}}}else{n=l.style.cssText;}if(/^(_moz)?$/.test(n)){continue;}h+=" "+b+'="'+HTMLArea.htmlEncode(n)+'"';}if(h!=""){if(k&&o=="p"){h+=">&nbsp;</p>";}else{if(k){h+=" />";}else{h+=">";}}}}}var e=false;
for(g=l.firstChild;g;g=g.nextSibling){if(!e&&g.nodeType==1&&HTMLArea.isBlockElement(g)){e=true;}h+=HTMLArea.getHTMLWrapper(g,true,j,d+"  ");}if(c&&!k){h+=(HTMLArea.is_ie&&HTMLArea.isBlockElement(l)&&e?("\n"+d):"")+"</"+l.tagName.toLowerCase()+">";}break;case 3:h=/^script|style$/i.test(l.parentNode.tagName)?l.data:HTMLArea.htmlEncode(l.data);
break;case 8:h="<!--"+l.data+"-->";break;}return h;};HTMLArea.prototype.stripBaseURL=function(a){if(this.config.baseHref==null||!this.config.stripBaseHref){return(a);}var b=this.config.baseHref;b=b.replace(/^(https?:\/\/[^\/]+)(.*)$/,"$1");basere=new RegExp(b);return a.replace(basere,"");};String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"");
};HTMLArea._makeColor=function(c){if(typeof c!="number"){return c;}var e=c&255;var d=(c>>8)&255;var a=(c>>16)&255;return"rgb("+e+","+d+","+a+")";};HTMLArea._colorToRgb=function(c){if(!c){return"";}function h(b){return(b<16)?("0"+b.toString(16)):b.toString(16);}if(typeof c=="number"){var f=c&255;var e=(c>>8)&255;
var a=(c>>16)&255;return"#"+h(f)+h(e)+h(a);}if(c.substr(0,3)=="rgb"){var d=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/;if(c.match(d)){var f=parseInt(RegExp.$1);var e=parseInt(RegExp.$2);var a=parseInt(RegExp.$3);return"#"+h(f)+h(e)+h(a);}return null;}if(c.substr(0,1)=="#"){return c;}return null;
};HTMLArea.prototype._popupDialog=function(a,b,c){Dialog(this.popupURL(a),b,c);};HTMLArea.prototype.imgURL=function(a,b){if(typeof b=="undefined"){return _editor_url+a;}else{return _editor_url+"plugins/"+b+"/img/"+a;}};HTMLArea.prototype.popupURL=function(c){var b="";if(c.match(/^plugin:\/\/(.*?)\/(.*)/)){var d=RegExp.$1;
var a=RegExp.$2;if(!/\.html$/.test(a)){a+=".html";}b=_editor_url+"plugins/"+d+"/popups/"+a;}else{if(c.match(/^\/.*?/)){b=c;}else{b=_editor_url+this.config.popupURL+c;}}return b;};HTMLArea.getElementById=function(a,e){var c,b,d=document.getElementsByTagName(a);for(b=d.length;--b>=0&&(c=d[b]);){if(c.id==e){return c;
}}return null;};HTMLArea.prototype._toggleBorders=function(){tables=this._doc.getElementsByTagName("TABLE");if(tables.length!=0){if(!this.borders){name="bordered";this.borders=true;}else{name="";this.borders=false;}for(var a=0;a<tables.length;a++){if(this.borders){if(HTMLArea.is_gecko){tables[a].style.display="none";
tables[a].style.display="table";}HTMLArea._addClass(tables[a],"htmtableborders");}else{HTMLArea._removeClass(tables[a],"htmtableborders");}}}return true;};HTMLArea.addClasses=function(f,e){if(f!=null){var b=f.className.trim().split(" ");var d=e.split(" ");for(var a=0;a<d.length;a++){var g=false;for(var c=0;
g==false&&c<b.length;c++){if(b[c]==d[a]){g=true;}}if(g==false){b[b.length]=d[a];}}f.className=b.join(" ").trim();}};HTMLArea.removeClasses=function(e,d){var g=e.className.trim().split();var f=[];var b=d.trim().split();for(var c=0;c<g.length;c++){var h=false;for(var a=0;a<b.length&&!h;a++){if(g[c]==b[a]){h=true;
}}if(!h){f[f.length]=g[c];}}return f.join(" ");};HTMLArea.addClass=HTMLArea._addClass;HTMLArea.removeClass=HTMLArea._removeClass;HTMLArea._addClasses=HTMLArea.addClasses;HTMLArea._removeClasses=HTMLArea.removeClasses;HTMLArea._postback=function(a,g,c){var e=null;if(HTMLArea.is_ie){e=new ActiveXObject("Microsoft.XMLHTTP");
}else{e=new XMLHttpRequest();}var d="";for(var b in g){d+=(d.length?"&":"")+b+"="+encodeURIComponent(g[b]);}function f(){if(e.readyState==4){if(e.status==200){if(typeof c=="function"){c(e.responseText,e);}}else{alert("An error has occurred: "+e.statusText);}}}e.onreadystatechange=f;e.open("POST",a,true);
e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");e.send(d);};HTMLArea._getback=function(a,b){var c=null;if(HTMLArea.is_ie){c=new ActiveXObject("Microsoft.XMLHTTP");}else{c=new XMLHttpRequest();}function d(){if(c.readyState==4){if(c.status==200){b(c.responseText,c);
}else{alert("An error has occurred: "+c.statusText);}}}c.onreadystatechange=d;c.open("GET",a,true);c.send(null);};HTMLArea._geturlcontent=function(a){var b=null;if(HTMLArea.is_ie){b=new ActiveXObject("Microsoft.XMLHTTP");}else{b=new XMLHttpRequest();}b.open("GET",a,false);b.send(null);if(b.status==200){return b.responseText;
}else{return"";}};if(typeof dump=="undefined"){function dump(b){var a="";for(var c in b){a+=c+" = "+b[c]+"\n";}x=window.open("","debugger");x.document.write("<pre>"+a+"</pre>");}}HTMLArea.arrayContainsArray=function(d,b){var c=true;for(var a=0;a<b.length;a++){var f=false;for(var e=0;e<d.length;e++){if(d[e]==b[a]){f=true;
break;}}if(!f){c=false;break;}}return c;};HTMLArea.arrayFilter=function(b,d){var c=[];for(var a=0;a<b.length;a++){if(d(b[a])){c[c.length]=b[a];}}return c;};HTMLArea.uniq_count=0;HTMLArea.uniq=function(a){return a+HTMLArea.uniq_count++;};HTMLArea._loadlang=function(context){if(typeof _editor_lcbackend=="string"){var url=_editor_lcbackend;
url=url.replace(/%lang%/,_editor_lang);url=url.replace(/%context%/,context);}else{if(context!="HTMLArea"){var url=_editor_url+"plugins/"+context+"/lang/"+_editor_lang+".js";}else{var url=_editor_url+"lang/"+_editor_lang+".js";}}var lang;var langData=HTMLArea._geturlcontent(url);if(langData!=""){try{eval("lang = "+langData);
}catch(Error){alert("Error reading Language-File ("+url+"):\n"+Error.toString());lang={};}}else{lang={};}return lang;};HTMLArea._lc=function(b,f,e){var a;if(_editor_lang=="en"){if(typeof b=="object"&&b.string){a=b.string;}else{a=b;}}else{if(typeof HTMLArea._lc_catalog=="undefined"){HTMLArea._lc_catalog=[];
}if(typeof f=="undefined"){f="HTMLArea";}if(typeof HTMLArea._lc_catalog[f]=="undefined"){HTMLArea._lc_catalog[f]=HTMLArea._loadlang(f);}var d;if(typeof b=="object"&&b.key){d=b.key;}else{if(typeof b=="object"&&b.string){d=b.string;}else{d=b;}}if(typeof HTMLArea._lc_catalog[f][d]=="undefined"){if(f=="HTMLArea"){if(typeof b=="object"&&b.string){a=b.string;
}else{a=b;}}else{return HTMLArea._lc(b,"HTMLArea",e);}}else{a=HTMLArea._lc_catalog[f][d];}}if(typeof b=="object"&&b.replace){e=b.replace;}if(typeof e!="undefined"){for(var c in e){a=a.replace("$"+c,e[c]);}}return a;};HTMLArea.hasDisplayedChildren=function(c){var b=c.childNodes;for(var a=0;a<b.length;
a++){if(b[a].tagName){if(b[a].style.display!="none"){return true;}}}return false;};HTMLArea._loadback=function(d,e){var c=document.getElementsByTagName("head")[0];var a=HTMLArea.is_ie?"onreadystatechange":"onload";var b=document.createElement("script");b.type="text/javascript";b.src=d;b[a]=function(){if(HTMLArea.is_ie&&!/loaded|complete/.test(window.event.srcElement.readyState)){return;
}e();};c.appendChild(b);};HTMLArea.collectionToArray=function(b){var c=[];for(var a=0;a<b.length;a++){c.push(b.item(a));}return c;};if(!Array.prototype.append){Array.prototype.append=function(b){for(var c=0;c<b.length;c++){this.push(b[c]);}return this;};}HTMLArea.makeEditors=function(b,e,f){if(typeof e=="function"){e=e();
}var d={};for(var a=0;a<b.length;a++){var c=new HTMLArea(b[a],HTMLArea.cloneObject(e));c.registerPlugins(f);d[b[a]]=c;}return d;};HTMLArea.startEditors=function(b){for(var a in b){if(b[a].generate){b[a].generate();}}};HTMLArea.prototype.registerPlugins=function(plugin_names){if(plugin_names){for(var i=0;
i<plugin_names.length;i++){this.registerPlugin(eval(plugin_names[i]));}}};HTMLArea.base64_encode=function(d){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var a="";var l,j,g;var k,h,f,e;var c=0;do{l=d.charCodeAt(c++);j=d.charCodeAt(c++);g=d.charCodeAt(c++);k=l>>2;h=((l&3)<<4)|(j>>4);
f=((j&15)<<2)|(g>>6);e=g&63;if(isNaN(j)){f=e=64;}else{if(isNaN(g)){e=64;}}a=a+b.charAt(k)+b.charAt(h)+b.charAt(f)+b.charAt(e);}while(c<d.length);return a;};HTMLArea.base64_decode=function(d){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var a="";var l,j,g;var k,h,f,e;var c=0;
d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{k=b.indexOf(d.charAt(c++));h=b.indexOf(d.charAt(c++));f=b.indexOf(d.charAt(c++));e=b.indexOf(d.charAt(c++));l=(k<<2)|(h>>4);j=((h&15)<<4)|(f>>2);g=((f&3)<<6)|e;a=a+String.fromCharCode(l);if(f!=64){a=a+String.fromCharCode(j);}if(e!=64){a=a+String.fromCharCode(g);
}}while(c<d.length);return a;};HTMLArea.removeFromParent=function(b){if(!b.parentNode){return;}var a=b.parentNode;a.removeChild(b);return b;};HTMLArea.hasParentNode=function(a){if(a.parentNode){if(a.parentNode.nodeType==11){return false;}return true;}return false;};if(HTMLArea.is_ie){HTMLArea.getOuterHTML=function(a){return a.outerHTML;
};}else{HTMLArea.getOuterHTML=function(a){return(new XMLSerializer()).serializeToString(a);};}HTMLArea.toFree=[];HTMLArea.freeLater=function(a,b){HTMLArea.toFree.push({o:a,p:b});};HTMLArea.free=function(c,d){if(c&&!d){for(var b in c){HTMLArea.free(c,b);}}else{if(c){try{c[d]=null;}catch(a){}}}};HTMLArea.collectGarbageForIE=function(){HTMLArea.flushEvents();
for(var a=0;a<HTMLArea.toFree.length;a++){if(!HTMLArea.toFree[a].o){alert("What is "+a+" "+HTMLArea.toFree[a].o);}HTMLArea.free(HTMLArea.toFree[a].o,HTMLArea.toFree[a].p);}};HTMLArea.init();HTMLArea.addDom0Event(window,"unload",HTMLArea.collectGarbageForIE);