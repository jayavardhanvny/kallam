var is_ie=((navigator.userAgent.toLowerCase().indexOf("msie")!=-1)&&(navigator.userAgent.toLowerCase().indexOf("opera")==-1));var is_compat=(document.compatMode=="BackCompat");function PopupDiv(d,j,g,e){var h=this;this.editor=d;this.doc=d._mdoc;this.handler=g;var b=this.doc.createElement("div");b.className="content";
var a=this.doc.createElement("div");a.className="dialog popupdiv";this.element=a;var i=a.style;i.position="absolute";i.left="0px";i.top="0px";var f=this.doc.createElement("div");f.className="title";this.title=f;a.appendChild(f);HTMLArea._addEvent(f,"mousedown",function(k){h._dragStart(is_ie?window.event:k);
});var c=this.doc.createElement("div");c.className="button";f.appendChild(c);c.innerHTML="&#x00d7;";f.appendChild(this.doc.createTextNode(j));this.titleText=j;c.onmouseover=function(){this.className+=" button-hilite";};c.onmouseout=function(){this.className=this.className.replace(/\s*button-hilite\s*/g," ");
};c.onclick=function(){this.className=this.className.replace(/\s*button-hilite\s*/g," ");h.close();};a.appendChild(b);this.content=b;this.doc.body.appendChild(a);this.dragging=false;this.onShow=null;this.onClose=null;this.modal=false;e(this);}PopupDiv.currentPopup=null;PopupDiv.prototype.showAtElement=function(b,e){this.defaultSize();
var g,f,c;var a=this.element;a.style.display="block";var k=a.offsetWidth;var d=a.offsetHeight;a.style.display="none";if(b!=window){g=PopupDiv.getAbsolutePos(b);f=b.offsetWidth;c=b.offsetHeight;}else{g={x:0,y:0};var l=PopupDiv.getWindowSize();f=l.x;c=l.y;}var j=false,i=false;if(e.indexOf("l")!=-1){g.x-=k;
j=true;}if(e.indexOf("r")!=-1){g.x+=f;j=true;}if(e.indexOf("t")!=-1){g.y-=d;i=true;}if(e.indexOf("b")!=-1){g.y+=c;i=true;}if(e.indexOf("c")!=-1){j||(g.x+=Math.round((f-k)/2));i||(g.y+=Math.round((c-d)/2));}this.showAt(g.x,g.y);};PopupDiv.prototype.defaultSize=function(){var d=this.element.style;var c=this.element.currentStyle;
var b=(is_ie&&is_compat)?(parseInt(c.borderLeftWidth)+parseInt(c.borderRightWidth)+parseInt(c.paddingLeft)+parseInt(c.paddingRight)):0;var a=(is_ie&&is_compat)?(parseInt(c.borderTopWidth)+parseInt(c.borderBottomWidth)+parseInt(c.paddingTop)+parseInt(c.paddingBottom)):0;d.display="block";d.width=(this.content.offsetWidth+b)+"px";
d.height=(this.content.offsetHeight+this.title.offsetHeight)+"px";d.display="none";};PopupDiv.prototype.showAt=function(x,y){this.defaultSize();var s=this.element.style;s.display="block";s.left=x+"px";s.top=y+"px";this.hideShowCovered();PopupDiv.currentPopup=this;HTMLArea._addEvents(this.doc.body,["mousedown","click"],PopupDiv.checkPopup);
HTMLArea._addEvents(this.editor._doc.body,["mousedown","click"],PopupDiv.checkPopup);if(is_ie&&this.modal){this.doc.body.setCapture(false);this.doc.body.onlosecapture=function(){(PopupDiv.currentPopup)&&(this.doc.body.setCapture(false));};}window.event&&HTMLArea._stopEvent(window.event);if(typeof this.onShow=="function"){this.onShow();
}else{if(typeof this.onShow=="string"){eval(this.onShow);}}var field=this.element.getElementsByTagName("input")[0];if(!field){field=this.element.getElementsByTagName("select")[0];}if(!field){field=this.element.getElementsByTagName("textarea")[0];}if(field){field.focus();}};PopupDiv.prototype.close=function(){this.element.style.display="none";
PopupDiv.currentPopup=null;this.hideShowCovered();HTMLArea._removeEvents(this.doc.body,["mousedown","click"],PopupDiv.checkPopup);HTMLArea._removeEvents(this.editor._doc.body,["mousedown","click"],PopupDiv.checkPopup);is_ie&&this.modal&&this.doc.body.releaseCapture();if(typeof this.onClose=="function"){this.onClose();
}else{if(typeof this.onClose=="string"){eval(this.onClose);}}this.element.parentNode.removeChild(this.element);};PopupDiv.prototype.getForm=function(){var a=this.content.getElementsByTagName("form");return(a.length>0)?a[0]:null;};PopupDiv.prototype.callHandler=function(){var c=["input","textarea","select"];
var g=new Object();for(var f=c.length;--f>=0;){var a=c[f];var d=this.content.getElementsByTagName(a);for(var b=0;b<d.length;++b){var e=d[b];g[e.name]=e.value;}}this.handler(this,g);return false;};PopupDiv.getAbsolutePos=function(b){var c={x:b.offsetLeft,y:b.offsetTop};if(b.offsetParent){var a=PopupDiv.getAbsolutePos(b.offsetParent);
c.x+=a.x;c.y+=a.y;}return c;};PopupDiv.getWindowSize=function(){if(window.innerHeight){return{y:window.innerHeight,x:window.innerWidth};}if(this.doc.body.clientHeight){return{y:this.doc.body.clientHeight,x:this.doc.body.clientWidth};}return{y:this.doc.documentElement.clientHeight,x:this.doc.documentElement.clientWidth};
};PopupDiv.prototype.hideShowCovered=function(){var s=this;function m(i){while(i){if(i==s.element){return true;}i=i.parentNode;}return false;}var t=new Array("applet","select");var b=this.element;var a=PopupDiv.getAbsolutePos(b);var e=a.x;var c=b.offsetWidth+e;var r=a.y;var q=b.offsetHeight+r;if(b.style.display=="none"){e=c=r=q=0;
}for(var g=t.length;g>0;){var f=this.doc.getElementsByTagName(t[--g]);var d=null;for(var j=f.length;j>0;){d=f[--j];if(m(d)){d.style.visibility="visible";continue;}a=PopupDiv.getAbsolutePos(d);var o=a.x;var n=d.offsetWidth+o;var l=a.y;var h=d.offsetHeight+l;if((o>c)||(n<e)||(l>q)||(h<r)){d.style.visibility="visible";
}else{d.style.visibility="hidden";}}}};PopupDiv.prototype._dragStart=function(b){if(this.dragging){return false;}this.dragging=true;PopupDiv.currentPopup=this;var d=b.clientX;var c=b.clientY;if(is_ie){c+=this.doc.body.scrollTop;d+=this.doc.body.scrollLeft;}else{c+=window.scrollY;d+=window.scrollX;}var a=this.element.style;
this.xOffs=d-parseInt(a.left);this.yOffs=c-parseInt(a.top);HTMLArea._addEvent(this.doc,"mousemove",PopupDiv.dragIt);HTMLArea._addEvent(this.doc,"mouseover",HTMLArea._stopEvent);HTMLArea._addEvent(this.doc,"mouseup",PopupDiv.dragEnd);HTMLArea._stopEvent(b);};PopupDiv.dragIt=function(c){var a=PopupDiv.currentPopup;
if(!(a&&a.dragging)){return false;}is_ie&&(c=window.event);var e=c.clientX;var d=c.clientY;if(is_ie){d+=this.doc.body.scrollTop;e+=this.doc.body.scrollLeft;}else{d+=window.scrollY;e+=window.scrollX;}a.hideShowCovered();var b=a.element.style;b.left=(e-a.xOffs)+"px";b.top=(d-a.yOffs)+"px";HTMLArea._stopEvent(c);
};PopupDiv.dragEnd=function(){var a=PopupDiv.currentPopup;if(!a){return false;}a.dragging=false;HTMLArea._removeEvent(a.doc,"mouseup",PopupDiv.dragEnd);HTMLArea._removeEvent(a.doc,"mouseover",HTMLArea._stopEvent);HTMLArea._removeEvent(a.doc,"mousemove",PopupDiv.dragIt);a.hideShowCovered();};PopupDiv.checkPopup=function(b){is_ie&&(b=window.event);
var a=is_ie?b.srcElement:b.target;var c=PopupDiv.currentPopup;for(;(a!=null)&&(a!=c.element);a=a.parentNode){}if(a==null){c.modal||b.type=="mouseover"||c.close();HTMLArea._stopEvent(b);}};PopupDiv.prototype.addButtons=function(){var a=this;var e=this.doc.createElement("div");this.content.appendChild(e);
e.className="buttons";for(var d=0;d<arguments.length;++d){var c=arguments[d];var b=this.doc.createElement("button");e.appendChild(b);b.innerHTML=HTMLArea._lc(buttons[c],"HTMLArea");switch(c){case"ok":b.onclick=function(){a.callHandler();a.close();};break;case"cancel":b.onclick=function(){a.close();};
break;}}};