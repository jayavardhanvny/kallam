<?xml version="1.0"?>
  <database name="VIEW FIN_DOUBTFUL_DEBT_V">
    <view name="FIN_DOUBTFUL_DEBT_V"><![CDATA[SELECT a.fin_doubtful_debt_v_id || to_char(1000 + b.aux) AS fin_doubtful_debt_v_id, a.fin_doubtful_debt_v_id AS fin_payment_schedule_id, a.ad_client_id, a.ad_org_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby, a.documentno, a.c_bpartner_id, a.c_bp_group_id, a.dateinvoiced, a.fin_paymentmethod_id, a.c_currency_id, a.duedate, to_date((trunc(now()) - b.aux)) AS rundate, a.amount, a.outstandingamt, a.doubtfuldebt_amount, a.daysoverdue - b.aux AS daysoverdue, a.fin_doubtful_debt_run_id, a.fin_doubtful_debt_id, a.ob_selected FROM (SELECT ps.fin_payment_schedule_id AS fin_doubtful_debt_v_id, ps.ad_client_id, ps.ad_org_id, ps.isactive, ps.created, ps.createdby, ps.updated, ps.updatedby, inv.documentno, inv.c_bpartner_id, bp.c_bp_group_id, inv.dateinvoiced, inv.fin_paymentmethod_id, inv.c_currency_id, ps.duedate, ps.amount, ps.outstandingamt, sum(COALESCE(dd.amount, 0)) AS doubtfuldebt_amount, trunc(now()) - trunc(ps.duedate) AS daysoverdue, dd.fin_doubtful_debt_run_id, dd.fin_doubtful_debt_id, CASE WHEN dd.fin_doubtful_debt_run_id IS NULL THEN 'N' ELSE 'Y' END AS ob_selected FROM fin_payment_schedule ps JOIN c_invoice inv ON ps.c_invoice_id = inv.c_invoice_id JOIN c_bpartner bp ON inv.c_bpartner_id = bp.c_bpartner_id LEFT JOIN fin_doubtful_debt dd ON dd.fin_payment_schedule_id = ps.fin_payment_schedule_id WHERE ps.outstandingamt > 0 AND inv.issotrx = 'Y' GROUP BY ps.fin_payment_schedule_id, ps.ad_client_id, ps.ad_org_id, ps.isactive, ps.created, ps.createdby, ps.updated, ps.updatedby, inv.documentno, inv.c_bpartner_id, bp.c_bp_group_id, inv.dateinvoiced, inv.fin_paymentmethod_id, inv.c_currency_id, ps.duedate, ps.amount, ps.outstandingamt, dd.amount, trunc(now()) - trunc(ps.duedate), dd.fin_doubtful_debt_run_id, dd.fin_payment_schedule_id, dd.fin_doubtful_debt_id UNION SELECT ps.fin_payment_schedule_id AS fin_doubtful_debt_v_id, ps.ad_client_id, ps.ad_org_id, ps.isactive, ps.created, ps.createdby, ps.updated, ps.updatedby, inv.documentno, inv.c_bpartner_id, bp.c_bp_group_id, inv.dateinvoiced, inv.fin_paymentmethod_id, inv.c_currency_id, ps.duedate, ps.amount, ps.outstandingamt - sum(COALESCE(dd.amount, 0)) AS outstandingamt, 0 AS doubtfuldebt_amount, trunc(now()) - trunc(ps.duedate) AS daysoverdue, '' AS fin_doubtful_debt_run_id, '' AS fin_doubtful_debt_id, 'N' AS ob_selected FROM fin_payment_schedule ps JOIN c_invoice inv ON ps.c_invoice_id = inv.c_invoice_id JOIN c_bpartner bp ON inv.c_bpartner_id = bp.c_bpartner_id LEFT JOIN fin_doubtful_debt dd ON dd.fin_payment_schedule_id = ps.fin_payment_schedule_id WHERE ps.outstandingamt > 0 AND inv.issotrx = 'Y' AND dd.processed = 'Y' GROUP BY ps.fin_payment_schedule_id, ps.ad_client_id, ps.ad_org_id, ps.isactive, ps.created, ps.createdby, ps.updated, ps.updatedby, inv.documentno, inv.c_bpartner_id, bp.c_bp_group_id, inv.dateinvoiced, inv.fin_paymentmethod_id, inv.c_currency_id, ps.duedate, ps.amount, ps.outstandingamt, dd.amount, trunc(now()) - trunc(ps.duedate), dd.fin_payment_schedule_id) a, (SELECT ad_integer.value - 1 AS aux FROM ad_integer WHERE ad_integer.value <= 1000) b ORDER BY a.fin_doubtful_debt_v_id, b.aux]]></view>
  </database>
