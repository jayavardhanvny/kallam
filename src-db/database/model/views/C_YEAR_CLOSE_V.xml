<?xml version="1.0"?>
  <database name="VIEW C_YEAR_CLOSE_V">
    <view name="C_YEAR_CLOSE_V"><![CDATA[SELECT (SELECT max(c_periodcontrol.c_periodcontrol_id) AS max FROM c_periodcontrol, c_period WHERE c_periodcontrol.c_period_id = c_period.c_period_id AND c_period.c_year_id = y.c_year_id AND c_periodcontrol.ad_org_id = o.ad_org_id) AS c_year_close_v_id, o.ad_client_id, o.ad_org_id, max(o.created) AS created, max(o.createdby) AS createdby, max(o.updated) AS updated, max(o.updatedby) AS updatedby, o.isactive, c.c_calendar_id, y.c_year_id, CASE WHEN max(closing.ad_org_closing_id) IS NULL THEN 'O' ELSE 'C' END AS status, CASE WHEN max(closing.ad_org_closing_id) IS NULL THEN 'C' ELSE 'O' END AS processed FROM ad_org o LEFT JOIN (SELECT ad_org.c_calendar_id, ad_org.ad_org_id FROM ad_org WHERE ad_org.c_calendar_id IS NOT NULL) c ON c.ad_org_id = ad_org_getcalendarowner(o.ad_org_id) LEFT JOIN c_year y ON c.c_calendar_id = y.c_calendar_id RIGHT JOIN c_period p ON y.c_year_id = p.c_year_id LEFT JOIN ad_org_closing closing ON (y.c_year_id || o.ad_org_id) = (closing.c_year_id || COALESCE(closing.ad_org_id, o.ad_org_id)) WHERE o.isperiodcontrolallowed = 'Y' AND o.isactive = 'Y' GROUP BY o.ad_client_id, o.ad_org_id, o.isactive, c.c_calendar_id, y.c_year_id]]></view>
  </database>
